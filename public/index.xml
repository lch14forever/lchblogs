<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Chenhao&#39;s Personal Page on Chenhao&#39;s Personal Page</title>
    <link>/</link>
    <description>Recent content in Chenhao&#39;s Personal Page on Chenhao&#39;s Personal Page</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <copyright>Â© This site was created with R BlogDown and HuGo by Chenhao Li.</copyright>
    <lastBuildDate>Sun, 15 Oct 2017 00:00:00 -0400</lastBuildDate>
    <atom:link href="/" rel="self" type="application/rss+xml" />
    
    <item>
      <title>åœ†è§’barplot</title>
      <link>/post/2022-05-32-r-round-corner/</link>
      <pubDate>Mon, 30 Aug 2021 00:00:00 +0000</pubDate>
      
      <guid>/post/2022-05-32-r-round-corner/</guid>
      <description>
&lt;script src=&#34;/rmarkdown-libs/header-attrs/header-attrs.js&#34;&gt;&lt;/script&gt;


&lt;div id=&#34;ä¾èµ–&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;ä¾èµ–&lt;/h3&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(dplyr)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 
## Attaching package: &amp;#39;dplyr&amp;#39;&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## The following objects are masked from &amp;#39;package:stats&amp;#39;:
## 
##     filter, lag&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## The following objects are masked from &amp;#39;package:base&amp;#39;:
## 
##     intersect, setdiff, setequal, union&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(ggplot2)&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;æ•°æ®&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;æ•°æ®&lt;/h3&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;dat &amp;lt;-  mutate(mtcars, index=1:n())
dat&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##                      mpg cyl  disp  hp drat    wt  qsec vs am gear carb index
## Mazda RX4           21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4     1
## Mazda RX4 Wag       21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4     2
## Datsun 710          22.8   4 108.0  93 3.85 2.320 18.61  1  1    4    1     3
## Hornet 4 Drive      21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1     4
## Hornet Sportabout   18.7   8 360.0 175 3.15 3.440 17.02  0  0    3    2     5
## Valiant             18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1     6
## Duster 360          14.3   8 360.0 245 3.21 3.570 15.84  0  0    3    4     7
## Merc 240D           24.4   4 146.7  62 3.69 3.190 20.00  1  0    4    2     8
## Merc 230            22.8   4 140.8  95 3.92 3.150 22.90  1  0    4    2     9
## Merc 280            19.2   6 167.6 123 3.92 3.440 18.30  1  0    4    4    10
## Merc 280C           17.8   6 167.6 123 3.92 3.440 18.90  1  0    4    4    11
## Merc 450SE          16.4   8 275.8 180 3.07 4.070 17.40  0  0    3    3    12
## Merc 450SL          17.3   8 275.8 180 3.07 3.730 17.60  0  0    3    3    13
## Merc 450SLC         15.2   8 275.8 180 3.07 3.780 18.00  0  0    3    3    14
## Cadillac Fleetwood  10.4   8 472.0 205 2.93 5.250 17.98  0  0    3    4    15
## Lincoln Continental 10.4   8 460.0 215 3.00 5.424 17.82  0  0    3    4    16
## Chrysler Imperial   14.7   8 440.0 230 3.23 5.345 17.42  0  0    3    4    17
## Fiat 128            32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1    18
## Honda Civic         30.4   4  75.7  52 4.93 1.615 18.52  1  1    4    2    19
## Toyota Corolla      33.9   4  71.1  65 4.22 1.835 19.90  1  1    4    1    20
## Toyota Corona       21.5   4 120.1  97 3.70 2.465 20.01  1  0    3    1    21
## Dodge Challenger    15.5   8 318.0 150 2.76 3.520 16.87  0  0    3    2    22
## AMC Javelin         15.2   8 304.0 150 3.15 3.435 17.30  0  0    3    2    23
## Camaro Z28          13.3   8 350.0 245 3.73 3.840 15.41  0  0    3    4    24
## Pontiac Firebird    19.2   8 400.0 175 3.08 3.845 17.05  0  0    3    2    25
## Fiat X1-9           27.3   4  79.0  66 4.08 1.935 18.90  1  1    4    1    26
## Porsche 914-2       26.0   4 120.3  91 4.43 2.140 16.70  0  1    5    2    27
## Lotus Europa        30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2    28
## Ford Pantera L      15.8   8 351.0 264 4.22 3.170 14.50  0  1    5    4    29
## Ferrari Dino        19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    6    30
## Maserati Bora       15.0   8 301.0 335 3.54 3.570 14.60  0  1    5    8    31
## Volvo 142E          21.4   4 121.0 109 4.11 2.780 18.60  1  1    4    2    32&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;åŸºç¡€ä½œå›¾&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;åŸºç¡€ä½œå›¾&lt;/h3&gt;
&lt;p&gt;æ¬§å¼åæ ‡&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;ggplot(dat, aes(x=index, y=mpg)) + 
  geom_bar(stat=&amp;quot;identity&amp;quot;) + 
  theme(axis.text.x = element_blank())&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2022-05-32-r-round-corner_files/figure-html/unnamed-chunk-3-1.png&#34; width=&#34;672&#34; /&gt;
æåæ ‡&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;ggplot(dat, aes(x=index, y=mpg)) + 
  geom_bar(stat=&amp;quot;identity&amp;quot;) + 
  theme(axis.text.x = element_blank()) + 
  coord_polar()&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2022-05-32-r-round-corner_files/figure-html/unnamed-chunk-4-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;æ–¹æ³•1geom_segment-lineend-round&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;æ–¹æ³•1ï¼š&lt;code&gt;geom_segment&lt;/code&gt; + &lt;code&gt;lineend = &#34;round&#34;&lt;/code&gt;&lt;/h3&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;ggplot(dat, aes(x=index, xend=index,  y=0,yend=mpg)) + 
  geom_segment(lwd=4, lineend = &amp;quot;round&amp;quot;)  +
  theme(axis.text.x = element_blank()) &lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2022-05-32-r-round-corner_files/figure-html/unnamed-chunk-5-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;ggplot(dat, aes(x=index, xend=index,  y=0,yend=mpg)) + 
  geom_segment(lwd=4, lineend = &amp;quot;round&amp;quot;) + 
  theme(axis.text.x = element_blank())  + 
  coord_polar()&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2022-05-32-r-round-corner_files/figure-html/unnamed-chunk-6-1.png&#34; width=&#34;672&#34; /&gt;
åœ¨æåæ ‡ä¸­ä¼¼ä¹ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œå› ä¸ºçº¿æ®µçš„å®½åº¦ä¸èƒ½æåæ ‡åŒ–&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;æ–¹æ³•2ggchicklet&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;æ–¹æ³•2ï¼š&lt;code&gt;ggchicklet&lt;/code&gt;&lt;/h3&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;#remotes::install_gitlab(&amp;quot;hrbrmstr/ggchicklet&amp;quot;)

ggplot(dat, aes(x=index,  y=mpg)) + 
  ggchicklet::geom_chicklet() + 
  theme(axis.text.x = element_blank())  &lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2022-05-32-r-round-corner_files/figure-html/unnamed-chunk-7-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;ggplot(dat, aes(x=index,  y=mpg)) + 
  ggchicklet::geom_chicklet() + 
  coord_polar() + 
  theme(axis.text.x = element_blank()) &lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2022-05-32-r-round-corner_files/figure-html/unnamed-chunk-8-1.png&#34; width=&#34;672&#34; /&gt;
åœ¨æåæ ‡ä¸‹å‡ºç°é”™è¯¯&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;æ–¹æ³•3elementalist&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;æ–¹æ³•3ï¼š&lt;code&gt;elementalist&lt;/code&gt;&lt;/h3&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;#remotes::install_github(&amp;quot;teunbrand/elementalist&amp;quot;)
ggplot(dat, aes(x=index, y = mpg)) +
  elementalist::geom_bar_theme(stat=&amp;quot;identity&amp;quot;,
    element = elementalist::element_rect_round(radius = 0.25)) +
  theme(axis.text.x = element_blank()) &lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2022-05-32-r-round-corner_files/figure-html/unnamed-chunk-9-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;ggplot(dat, aes(x=index, y = mpg)) +
  elementalist::geom_bar_theme(stat=&amp;quot;identity&amp;quot;,
    element = elementalist::element_rect_round(radius = 0.25)) +
  theme(axis.text.x = element_blank()) +
  coord_polar()&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Error: Polar coordinates not implemented yet. Feel free to leave an issue on the github tracker.&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2022-05-32-r-round-corner_files/figure-html/unnamed-chunk-10-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;ä½œè€…è¯´ï¼Œæåæ ‡è¿™ä¸ªåŠŸèƒ½è¿˜æ²¡æœ‰å®ç°ğŸ˜…&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;æœ€ç»ˆæ–¹æ³•ggforcegeom_shape&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;æœ€ç»ˆæ–¹æ³•ï¼š&lt;code&gt;ggforce::geom_shape()&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;å¯¹&lt;code&gt;x&lt;/code&gt;ï¼Œ&lt;code&gt;y&lt;/code&gt;è¿›è¡Œå¤„ç†&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;w &amp;lt;- 0.4

dat2 &amp;lt;- rbind(
  mutate(dat, index.new=index-w, mpg=0),
  mutate(dat, index.new=index+w, mpg=0),
  mutate(dat, index.new=index+w, mpg=mpg),
  mutate(dat, index.new=index-w, mpg=mpg)
  ) &lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;ggplot(dat2, aes(x=index.new, y=mpg, group=index)) + 
  ggforce::geom_shape(radius = unit(1.2, &amp;#39;mm&amp;#39;) ) +
  theme(axis.text.x = element_blank())&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2022-05-32-r-round-corner_files/figure-html/unnamed-chunk-12-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;ggplot(dat2, aes(x=index.new, y=mpg, group=index)) + 
  ggforce::geom_shape( radius = unit(1.2, &amp;#39;mm&amp;#39;)) +
  coord_polar() + 
  labs(x=NULL, y=NULL) + 
  theme(axis.text = element_blank(), axis.ticks = element_blank()) &lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2022-05-32-r-round-corner_files/figure-html/unnamed-chunk-13-1.png&#34; width=&#34;576&#34; /&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;è¿è¡Œä¿¡æ¯&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;è¿è¡Œä¿¡æ¯&lt;/h3&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;sessionInfo()&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## R version 4.0.5 (2021-03-31)
## Platform: x86_64-apple-darwin17.0 (64-bit)
## Running under: macOS Big Sur 10.16
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRblas.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] ggplot2_3.3.5 dplyr_1.0.7  
## 
## loaded via a namespace (and not attached):
##  [1] Rcpp_1.0.7              highr_0.9               pillar_1.6.2           
##  [4] bslib_0.2.5.1           compiler_4.0.5          jquerylib_0.1.4        
##  [7] tools_4.0.5             elementalist_0.0.0.9000 ggchicklet_0.5.2       
## [10] digest_0.6.27           jsonlite_1.7.2          evaluate_0.14          
## [13] lifecycle_1.0.0         tibble_3.1.3            gtable_0.3.0           
## [16] pkgconfig_2.0.3         rlang_0.4.11            DBI_1.1.1              
## [19] yaml_2.2.1              blogdown_1.4            xfun_0.22              
## [22] withr_2.4.2             stringr_1.4.0           knitr_1.33             
## [25] generics_0.1.0          vctrs_0.3.8             sass_0.4.0             
## [28] grid_4.0.5              tidyselect_1.1.1        glue_1.4.2             
## [31] R6_2.5.0                fansi_0.5.0             rmarkdown_2.10         
## [34] bookdown_0.23           polyclip_1.10-0         tweenr_1.0.2           
## [37] farver_2.1.0            purrr_0.3.4             magrittr_2.0.1         
## [40] MASS_7.3-53.1           scales_1.1.1            ellipsis_0.3.2         
## [43] htmltools_0.5.1.1       assertthat_0.2.1        ggforce_0.3.3          
## [46] colorspace_2.0-2        labeling_0.4.2          utf8_1.2.2             
## [49] stringi_1.7.3           munsell_0.5.0           crayon_1.4.1&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>è®©Single cell UMAPæ³¨é‡Šæ”¯æ£±èµ·æ¥</title>
      <link>/post/2021-08-12-singlecell-annotation-ggforce/</link>
      <pubDate>Mon, 30 Aug 2021 00:00:00 +0000</pubDate>
      
      <guid>/post/2021-08-12-singlecell-annotation-ggforce/</guid>
      <description>
&lt;script src=&#34;/rmarkdown-libs/header-attrs/header-attrs.js&#34;&gt;&lt;/script&gt;


&lt;p&gt;æœ€è¿‘åœ¨ç”»UMAPçš„æ—¶å€™å‘ç°æœ‰çš„æ—¶å€™ç»†èƒäºšç¾¤çš„æ³¨é‡Šä¸ç‚¹é‡åˆé¢œè‰²ä¸Šä¸æ˜¯å¾ˆæ­é…ï¼ŒåŒäº‹æå‡ºè®©æ³¨é‡Šâ€œæ”¯æ£±â€èµ·æ¥ï¼Œé¦–å…ˆæƒ³åˆ°çš„æ˜¯ggforceä¸­çš„&lt;code&gt;geom_mark_ellipse&lt;/code&gt;ï¼Œå®è·µä¸­é‡åˆ°ä¸€äº›é—®é¢˜ï¼Œäºæ˜¯æœ‰äº†ç¬¬ä¸€ç¯‡Single cellçš„è®°å½•ã€‚&lt;/p&gt;
&lt;div class=&#34;figure&#34;&gt;
&lt;img src=&#34;https://ggforce.data-imaginist.com/reference/geom_mark_ellipse-2.png&#34; alt=&#34;&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;ggforee&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;å°è¯•ç”¨ggforceæ³¨é‡Š&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;å°è¯•ç”¨ggforceæ³¨é‡Š&lt;/h3&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(dplyr)
library(Seurat)
library(SeuratData)
library(patchwork)
library(ggforce)
##InstallData(&amp;quot;pbmc3k&amp;quot;)
data(&amp;quot;pbmc3k&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;points &amp;lt;- 
  data.frame(pbmc3k.final@reductions$umap@cell.embeddings, cluster=Idents(pbmc3k.final))

DimPlot(pbmc3k.final) + 
  geom_mark_ellipse(data=points, aes(x=UMAP_1, y=UMAP_2, label=cluster, col=cluster),
                    inherit.aes = F) + 
  NoLegend()&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2021-08-12-singlecell-annotation-ggforce_files/figure-html/unnamed-chunk-2-1.png&#34; width=&#34;864&#34; /&gt;&lt;/p&gt;
&lt;p&gt;éå¸¸éš¾çœ‹ä¸æ˜¯å—ï¼Ÿå› ä¸ºæœ‰ä¸€äº›clusterï¼ˆNaive CD4 Tï¼‰å­˜åœ¨å¼‚å¸¸å€¼ï¼Œggforceä¸­çš„å‡½æ•°ä¼šåŒ…å«æ‰€æœ‰çš„ç‚¹ã€‚æ‰€ä»¥åº”è¯¥å°†å¼‚å¸¸å€¼å»æ‰ï¼Œè¿™ä¸ªæ–¹æ³•æœ‰å¾ˆå¤šï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯ä¹‹å‰ç”¨åˆ°çš„ç½®ä¿¡æ¤­åœ†çš„æ–¹æ³•ã€‚&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;ä¿®æ”¹&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;ä¿®æ”¹&lt;/h3&gt;
&lt;p&gt;æ€è·¯å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹æ¯ä¸€ä¸ªclusterè®¡ç®—ä¸€ä¸ªå°½é‡å°çš„ç½®ä¿¡æ¤­åœ†&lt;/li&gt;
&lt;li&gt;ç”¨ç½®ä¿¡æ¤­åœ†ä¸Šçš„ç‚¹æ¥ç”»geom_mark_ellipse&lt;/li&gt;
&lt;/ul&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;points &amp;lt;- 
  data.frame(pbmc3k.final@reductions$umap@cell.embeddings, cluster=Idents(pbmc3k.final))

## adapted from https://github.com/fawda123/ggord/blob/master/R/ggord.R
theta &amp;lt;- c(seq(-pi, pi, length = 50), seq(pi, -pi, length = 50))
circle &amp;lt;- cbind(cos(theta), sin(theta))

library(plyr)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## ------------------------------------------------------------------------------&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## You have loaded plyr after dplyr - this is likely to cause problems.
## If you need functions from both plyr and dplyr, please load plyr first, then dplyr:
## library(plyr); library(dplyr)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## ------------------------------------------------------------------------------&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## 
## Attaching package: &amp;#39;plyr&amp;#39;&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## The following objects are masked from &amp;#39;package:dplyr&amp;#39;:
## 
##     arrange, count, desc, failwith, id, mutate, rename, summarise,
##     summarize&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;aux &amp;lt;- function(x, one, two, prob=0.8) {
    if(nrow(x) &amp;lt;= 2) {
      return(NULL)
    }
    sigma &amp;lt;- var(cbind(x[,one], x[,two]))
    mu &amp;lt;- c(mean(x[,one]), mean(x[,two]))
    ed &amp;lt;- sqrt(qchisq(prob, df = 2))
    data.frame(sweep(circle %*% chol(sigma) * ed, 2, mu, FUN = &amp;#39;+&amp;#39;))
}
ell &amp;lt;- plyr::ddply(points, &amp;quot;cluster&amp;quot;, aux, one=&amp;quot;UMAP_1&amp;quot;, two=&amp;quot;UMAP_2&amp;quot;)


DimPlot(pbmc3k.final) + 
  geom_mark_ellipse(data=ell, aes(x=X1, y=X2, label=cluster, col=cluster),
                    inherit.aes = F) + 
  NoLegend()&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2021-08-12-singlecell-annotation-ggforce_files/figure-html/unnamed-chunk-3-1.png&#34; width=&#34;864&#34; /&gt;
### å¾®è°ƒ&lt;/p&gt;
&lt;p&gt;ä¸‹é¢å°±æ˜¯è¿›è¡Œä¸€äº›å¾®è°ƒï¼Œå°†æ¤­åœ†ç¼©å°ä½¿æ³¨é‡ŠæŒ‡åœ¨äºšç¾¤ä¸Šæ›´å¥½çš„ä½ç½®&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;## è°ƒæ•´probå‚æ•°
ell &amp;lt;- plyr::ddply(points, &amp;quot;cluster&amp;quot;, aux, one=&amp;quot;UMAP_1&amp;quot;, two=&amp;quot;UMAP_2&amp;quot;, prob=0.1)
DimPlot(pbmc3k.final) + 
  geom_mark_ellipse(data=ell, aes(x=X1, y=X2, label=cluster, col=cluster),
                    inherit.aes = F) + 
  NoLegend()&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2021-08-12-singlecell-annotation-ggforce_files/figure-html/unnamed-chunk-4-1.png&#34; width=&#34;768&#34; /&gt;
æŠŠæ¤­åœ†éšè—&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;DimPlot(pbmc3k.final) + 
  geom_mark_ellipse(data=ell, aes(x=X1, y=X2, label=cluster, group=cluster),
                    color=NA,
                    inherit.aes = F) + 
  NoLegend()&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2021-08-12-singlecell-annotation-ggforce_files/figure-html/unnamed-chunk-5-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
&lt;p&gt;Voila!&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;å½©è›‹&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;å½©è›‹&lt;/h3&gt;
&lt;p&gt;æˆ‘åœ¨&lt;code&gt;ggesentials&lt;/code&gt;ä¸­å†™äº†&lt;code&gt;theme_umap_ge&lt;/code&gt;å‡½æ•°ï¼Œç”¨æ¥ç”»UMAPçš„å°åæ ‡ã€‚&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(ggessentials)
DimPlot(pbmc3k.final) + 
  theme_umap_ge(aes_x = &amp;quot;UMAP_1&amp;quot;, aes_y = &amp;quot;UMAP_2&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;/post/2021-08-12-singlecell-annotation-ggforce_files/figure-html/unnamed-chunk-6-1.png&#34; width=&#34;768&#34; /&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;è¿è¡Œä¿¡æ¯&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;è¿è¡Œä¿¡æ¯&lt;/h3&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;sessionInfo()&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## R version 4.0.5 (2021-03-31)
## Platform: x86_64-apple-darwin17.0 (64-bit)
## Running under: macOS Big Sur 10.16
## 
## Matrix products: default
## BLAS:   /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRblas.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/4.0/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] ggessentials_0.1.0      plyr_1.8.6              ggforce_0.3.3          
##  [4] ggplot2_3.3.5           patchwork_1.1.1         pbmc3k.SeuratData_3.1.4
##  [7] SeuratData_0.2.1        SeuratObject_4.0.2      Seurat_4.0.3           
## [10] dplyr_1.0.7            
## 
## loaded via a namespace (and not attached):
##   [1] Rtsne_0.15            colorspace_2.0-2      deldir_0.2-10        
##   [4] ellipsis_0.3.2        ggridges_0.5.3        rstudioapi_0.13      
##   [7] spatstat.data_2.1-0   farver_2.1.0          leiden_0.3.9         
##  [10] listenv_0.8.0         ggrepel_0.9.1         fansi_0.5.0          
##  [13] codetools_0.2-18      splines_4.0.5         knitr_1.33           
##  [16] polyclip_1.10-0       jsonlite_1.7.2        ica_1.0-2            
##  [19] cluster_2.1.1         png_0.1-7             uwot_0.1.10          
##  [22] shiny_1.6.0           sctransform_0.3.2     spatstat.sparse_2.0-0
##  [25] compiler_4.0.5        httr_1.4.2            Matrix_1.3-4         
##  [28] fastmap_1.1.0         lazyeval_0.2.2        cli_3.0.1            
##  [31] tweenr_1.0.2          later_1.2.0           htmltools_0.5.1.1    
##  [34] tools_4.0.5           igraph_1.2.6          gtable_0.3.0         
##  [37] glue_1.4.2            RANN_2.6.1            reshape2_1.4.4       
##  [40] rappdirs_0.3.3        Rcpp_1.0.7            scattermore_0.7      
##  [43] jquerylib_0.1.4       vctrs_0.3.8           nlme_3.1-152         
##  [46] blogdown_1.4          lmtest_0.9-38         xfun_0.22            
##  [49] stringr_1.4.0         globals_0.14.0        mime_0.11            
##  [52] miniUI_0.1.1.1        lifecycle_1.0.0       irlba_2.3.3          
##  [55] goftest_1.2-2         future_1.21.0         MASS_7.3-53.1        
##  [58] zoo_1.8-9             scales_1.1.1          spatstat.core_2.3-0  
##  [61] promises_1.2.0.1      spatstat.utils_2.2-0  parallel_4.0.5       
##  [64] RColorBrewer_1.1-2    yaml_2.2.1            reticulate_1.20      
##  [67] pbapply_1.4-3         gridExtra_2.3         sass_0.4.0           
##  [70] rpart_4.1-15          stringi_1.7.3         highr_0.9            
##  [73] rlang_0.4.11          pkgconfig_2.0.3       matrixStats_0.60.0   
##  [76] evaluate_0.14         lattice_0.20-41       ROCR_1.0-11          
##  [79] purrr_0.3.4           tensor_1.5            labeling_0.4.2       
##  [82] htmlwidgets_1.5.3     cowplot_1.1.1         tidyselect_1.1.1     
##  [85] ggsci_2.9             parallelly_1.27.0     RcppAnnoy_0.0.19     
##  [88] magrittr_2.0.1        bookdown_0.23         R6_2.5.0             
##  [91] generics_0.1.0        withr_2.4.2           pillar_1.6.2         
##  [94] mgcv_1.8-34           fitdistrplus_1.1-5    survival_3.2-10      
##  [97] abind_1.4-5           tibble_3.1.3          future.apply_1.8.1   
## [100] crayon_1.4.1          KernSmooth_2.23-18    utf8_1.2.2           
## [103] spatstat.geom_2.2-2   plotly_4.9.4.1        rmarkdown_2.10       
## [106] grid_4.0.5            data.table_1.14.0     digest_0.6.27        
## [109] xtable_1.8-4          tidyr_1.1.3           httpuv_1.6.1         
## [112] munsell_0.5.0         viridisLite_0.4.0     bslib_0.2.5.1&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>Nextflowé•¿å‘½ä»¤segmentation faultçš„è§£å†³</title>
      <link>/post/2021-08-08-nextflow-trick/</link>
      <pubDate>Sun, 08 Aug 2021 00:00:00 +0000</pubDate>
      
      <guid>/post/2021-08-08-nextflow-trick/</guid>
      <description>
&lt;script src=&#34;/rmarkdown-libs/header-attrs/header-attrs.js&#34;&gt;&lt;/script&gt;


&lt;p&gt;æœ€è¿‘åœ¨Macä¸Šè¿è¡Œnextflowçš„ä¸€ä¸ªæµç¨‹ï¼Œæµç¨‹ä¸‹è½½ä¸Šåƒä¸ªæ–‡ä»¶ï¼Œç„¶åå…¶ä¸­ä¸€æ­¥æ¶‰åŠå°†è¿™ä¸Šåƒä¸ªæ–‡ä»¶æ‹·è´åˆ°ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹ï¼Œè¿è¡Œçš„å‘½ä»¤å¤§æ¦‚å¦‚ä¸‹&lt;/p&gt;
&lt;pre class=&#34;sh&#34;&gt;&lt;code&gt;cp d0001.rds d0002.rds d0003.rds ... d1000.rds data_rds/&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åœ¨nextflowçš„æµç¨‹ä¸­è¿™æ ·å®ç°&lt;/p&gt;
&lt;pre class=&#34;nextflow&#34;&gt;&lt;code&gt;process gatherRDS {
    input:
      file rds
    output:
      path &amp;quot;data&amp;quot;
    script:
      &amp;quot;&amp;quot;&amp;quot;
      mkdir data
      cp $rds data/
      &amp;quot;&amp;quot;&amp;quot;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä½†æ˜¯è¿è¡Œæ—¶ä¸æ–­é‡åˆ°segmentation faultçš„æƒ…å†µï¼ˆMacOS Big Sur 11.5ï¼‰ã€‚åœ¨githubæ‰¾åˆ°äº†&lt;a href=&#34;https://github.com/nextflow-io/nextflow/issues/1364&#34;&gt;ç­”æ¡ˆ&lt;/a&gt;ã€‚åŠ å…¥&lt;code&gt;ulimit -Ss unlimited&lt;/code&gt;ï¼Œå¯ä»¥è§£é™¤å¯¹ç¨‹åºçš„å†…å­˜é™åˆ¶ï¼Œè§£å†³é—®é¢˜ã€‚&lt;/p&gt;
&lt;pre class=&#34;nextflow&#34;&gt;&lt;code&gt;process gatherRDS {
    beforeScript &amp;#39;ulimit -Ss unlimited&amp;#39; // avoid long input segfault

    input:
      file rds
    output:
      path &amp;quot;data&amp;quot;
    script:
      &amp;quot;&amp;quot;&amp;quot;
      mkdir data
      cp $rds data/
      &amp;quot;&amp;quot;&amp;quot;
}&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
    <item>
      <title>nf-coreæµç¨‹ä½¿ç”¨</title>
      <link>/post/2021-05-20-nextflow-nfcore/</link>
      <pubDate>Thu, 20 May 2021 00:00:00 +0000</pubDate>
      
      <guid>/post/2021-05-20-nextflow-nfcore/</guid>
      <description>
&lt;script src=&#34;/rmarkdown-libs/header-attrs/header-attrs.js&#34;&gt;&lt;/script&gt;


&lt;p&gt;&lt;a href=&#34;https://nf-co.re/&#34;&gt;nf-core&lt;/a&gt;æ˜¯ç”±Nextflowä½¿ç”¨å¼€å‘è€…å…±åŒå¼€å‘ç»´æŠ¤çš„ä¼˜ç§€é¡¹ç›®ï¼Œæ¶µç›–å„ç§ç”Ÿä¿¡æ•°æ®åˆ†æçš„é«˜è´¨é‡æµç¨‹ã€‚ä¾èµ–äºNextflowçš„ä¼˜åŠ¿ï¼ŒåŸºæœ¬å¯ä»¥åœ¨ä»»ä½•HPCç¯å¢ƒå³æ’å³ç”¨ï¼Œè§£å†³ç”Ÿä¿¡åˆ†æä¸­è§„æ¨¡åŒ–ã€å¯é‡å¤æ€§ç­‰ä¼—å¤šç—›ç‚¹ã€‚æœ¬æ–‡ä»¥ATAC-Seqä¸ºä¾‹ï¼Œä»‹ç»å¦‚ä½•ä½¿ç”¨nf-coreä¸­çš„æµç¨‹ã€‚è¯¥æµç¨‹ä»è´¨æ§ã€æ¯”å¯¹åˆ°å·®å¼‚åˆ†æã€IGVå¯è§†åŒ–ä¸€é”®å®Œæˆã€‚&lt;/p&gt;
&lt;div id=&#34;æµ‹è¯•ç¯å¢ƒ&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;æµ‹è¯•ç¯å¢ƒ&lt;/h3&gt;
&lt;p&gt;Ubuntu 20.04 ï¼ˆRootæƒé™ï¼‰&lt;/p&gt;
&lt;p&gt;å®‰è£…Docker&lt;/p&gt;
&lt;pre class=&#34;sh&#34;&gt;&lt;code&gt;sudo snap install docker # ç”¨snapå®‰è£…
sudo usermod -aG docker ${USER} # ä¿®æ­£æƒé™é—®é¢˜&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å®‰è£…java&lt;/p&gt;
&lt;pre class=&#34;sh&#34;&gt;&lt;code&gt;sudo apt install default-jdk&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å®‰è£…nextflow&lt;/p&gt;
&lt;pre class=&#34;sh&#34;&gt;&lt;code&gt;curl -fsSL get.nextflow.io | bash
sudo mv nextflow /usr/local/bin&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä¸‹è½½&lt;a href=&#34;https://nf-co.re/atacseq&#34;&gt;nf-core/atacseq&lt;/a&gt;æµç¨‹å¹¶è¿è¡Œå®ä¾‹&lt;/p&gt;
&lt;pre class=&#34;sh&#34;&gt;&lt;code&gt; nextflow run nf-core/atacseq -profile test,docker&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;è¿è¡Œ&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;è¿è¡Œ&lt;/h3&gt;
&lt;p&gt;æ ¹æ®è‡ªå·±çš„æ ·æœ¬ï¼Œåˆ›å»ºä¸€ä¸ªä»¥ä¸‹æ ¼å¼çš„csvæ–‡ä»¶&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;group,replicate,fastq_1,fastq_2
control,1,AEG588A1_S1_L002_R1_001.fastq.gz,AEG588A1_S1_L002_R2_001.fastq.gz
control,2,AEG588A2_S2_L002_R1_001.fastq.gz,AEG588A2_S2_L002_R2_001.fastq.gz
control,3,AEG588A3_S3_L002_R1_001.fastq.gz,AEG588A3_S3_L002_R2_001.fastq.gz
treatment,1,AEG588A4_S4_L003_R1_001.fastq.gz,AEG588A4_S4_L003_R2_001.fastq.gz
treatment,2,AEG588A5_S5_L003_R1_001.fastq.gz,AEG588A5_S5_L003_R2_001.fastq.gz
treatment,3,AEG588A6_S6_L003_R1_001.fastq.gz,AEG588A6_S6_L003_R2_001.fastq.gz
treatment,3,AEG588A6_S6_L004_R1_001.fastq.gz,AEG588A6_S6_L004_R2_001.fastq.gz&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;group&lt;/code&gt;ï¼šå®éªŒç»„åˆ«ï¼Œå¦‚å®éªŒç»„ã€å¯¹ç…§ç»„&lt;/li&gt;
&lt;li&gt;&lt;code&gt;replicate&lt;/code&gt;ï¼šå®éªŒé‡å¤ç¼–å·&lt;/li&gt;
&lt;li&gt;&lt;code&gt;fastq_1&lt;/code&gt;ï¼šfastq1ç»å¯¹è·¯å¾„&lt;/li&gt;
&lt;li&gt;&lt;code&gt;fastq_2&lt;/code&gt;ï¼šfastq2ç»å¯¹è·¯å¾„&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿è¡Œ&lt;/p&gt;
&lt;pre class=&#34;sh&#34;&gt;&lt;code&gt;export NXF_OPTS=&amp;#39;-Xms1g -Xmx4g&amp;#39; # å»ºè®®é™åˆ¶Javaè™šæ‹Ÿæœºçš„å†…å­˜
nextflow run nf-core/atacseq --input design.csv --genome GRCh37 -profile docker&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;å‚è€ƒ&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;å‚è€ƒ&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://nf-co.re/pipelines&#34; class=&#34;uri&#34;&gt;https://nf-co.re/pipelines&lt;/a&gt;
&lt;a href=&#34;https://nf-co.re/atacseq/1.2.1/usage&#34; class=&#34;uri&#34;&gt;https://nf-co.re/atacseq/1.2.1/usage&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>Telegram botåŸºç¡€ä½¿ç”¨</title>
      <link>/post/2021-05-11-telegrambot/</link>
      <pubDate>Tue, 11 May 2021 00:00:00 +0000</pubDate>
      
      <guid>/post/2021-05-11-telegrambot/</guid>
      <description>
&lt;script src=&#34;/rmarkdown-libs/header-attrs/header-attrs.js&#34;&gt;&lt;/script&gt;


&lt;div id=&#34;ç”³è¯·telegram-bot&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;ç”³è¯·telegram bot&lt;/h2&gt;
&lt;ol style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;åœ¨telegramä¸­æœç´¢â€œBotFatherâ€ï¼Œè¿›å…¥ä¸å…¶èŠå¤©é¡µé¢&lt;/li&gt;
&lt;li&gt;è¾“å…¥&lt;code&gt;/start&lt;/code&gt;æŸ¥çœ‹å¯ç”¨é€‰é¡¹&lt;/li&gt;
&lt;li&gt;è¾“å…¥æˆ–ç‚¹å‡»&lt;code&gt;/newbot&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;è¾“å…¥botçš„åå­—ï¼ˆå¿…é¡»ä»¥&lt;code&gt;Bot&lt;/code&gt;æˆ–&lt;code&gt;_bot&lt;/code&gt;ç»“å°¾ï¼‰&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å®Œæˆåæ”¶åˆ°å¦‚ä¸‹æ¶ˆæ¯ï¼Œç‚¹å‡»&lt;code&gt;t.me/xxxxxx_bot&lt;/code&gt;å³å¯è¿›å…¥ä¸botèŠå¤©é¡µé¢&lt;/p&gt;
&lt;p&gt;Done! Congratulations on your new bot. You will find it at &lt;code&gt;t.me/xxxxxx_bot&lt;/code&gt;. You can now add a description, about section and profile picture for your bot, see /help for a list of commands. By the way, when youâ€™ve finished creating your cool bot, ping our Bot Support if you want a better username for it. Just make sure the bot is fully operational before you do this.&lt;/p&gt;
&lt;p&gt;Use this token to access the HTTP API:
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
Keep your token secure and store it safely, it can be used by anyone to control your bot.&lt;/p&gt;
&lt;p&gt;For a description of the Bot API, see this page: &lt;a href=&#34;https://core.telegram.org/bots/api&#34; class=&#34;uri&#34;&gt;https://core.telegram.org/bots/api&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;ä½¿ç”¨curlå‘é€æ¶ˆæ¯&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;ä½¿ç”¨cURLå‘é€æ¶ˆæ¯&lt;/h2&gt;
&lt;ol style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;åœ¨ä¸botèŠå¤©é¡µé¢è¾“å…¥ä»»æ„æ¶ˆæ¯&lt;/li&gt;
&lt;li&gt;æ‰“å¼€https://api.telegram.org/bot&lt;code&gt;{TOKEN}&lt;/code&gt;/getUpdates ï¼ˆè¿™é‡Œæœ‰è¿™ä¸ªbotçš„æ¶ˆæ¯å†å²ï¼‰&lt;/li&gt;
&lt;li&gt;åœ¨è¿™ä¸ªJSONæ–‡ä»¶ä¸­æ‰¾åˆ°&lt;code&gt;CHAT_ID&lt;/code&gt; (â€¦â€œchatâ€:{â€œidâ€:{CHAT_ID}â€¦)&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ¥ä¸‹æ¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å‘é€æ¶ˆæ¯ï¼ˆTOKENå’ŒCHAT_IDæ›¿æ¢ä¸ºè‡ªå·±çš„ï¼‰ï¼Œå¥½åƒç¾¤ç»„çš„chat IDä¸ºè´Ÿæ•°ï¼Œä¸ªäººçš„chat IDä¸ºæ­£æ•°&lt;/p&gt;
&lt;pre class=&#34;sh&#34;&gt;&lt;code&gt;TELEGRAM_BOT_TOKEN=TOKEN
curl -X POST \
     -H &amp;#39;Content-Type: application/json&amp;#39; \
     -d &amp;#39;{&amp;quot;chat_id&amp;quot;: &amp;quot;CHAT_ID&amp;quot;, &amp;quot;text&amp;quot;: &amp;quot;æµ‹è¯•æ¶ˆæ¯ï¼&amp;quot;}&amp;#39;
     &amp;quot;https://api.telegram.org/bot$TELEGRAM_BOT_TOKEN/sendMessage&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;çœ‹åˆ°å¦‚ä¸‹æç¤ºï¼Œå¹¶æ”¶åˆ°telegramæ¶ˆæ¯&lt;/p&gt;
&lt;pre class=&#34;sh&#34;&gt;&lt;code&gt;{&amp;quot;ok&amp;quot;:true,&amp;quot;result&amp;quot;:{&amp;quot;message_id&amp;quot;:14,&amp;quot;from&amp;quot;:{&amp;quot;id&amp;quot;:BOT_ID,&amp;quot;is_bot&amp;quot;:true,&amp;quot;first_name&amp;quot;:&amp;quot;xxxxxxx_bot&amp;quot;,&amp;quot;username&amp;quot;:&amp;quot;xxxxxxxx_bot&amp;quot;},&amp;quot;chat&amp;quot;:{&amp;quot;id&amp;quot;:CHAT_ID,&amp;quot;first_name&amp;quot;:&amp;quot;XXXX&amp;quot;,&amp;quot;type&amp;quot;:&amp;quot;private&amp;quot;},&amp;quot;date&amp;quot;:1620736546,&amp;quot;text&amp;quot;:&amp;quot;æµ‹è¯•æ¶ˆæ¯ï¼&amp;quot;}}%&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;å‚è€ƒ&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;å‚è€ƒ&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;https://www.freecodecamp.org/news/telegram-push-notifications-58477e71b2c2/&#34; class=&#34;uri&#34;&gt;https://www.freecodecamp.org/news/telegram-push-notifications-58477e71b2c2/&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>BEEM-Static: Accurate inference of ecological interactions from cross-sectional metagenomic data</title>
      <link>/publication/biorxiv_beemstatic/</link>
      <pubDate>Tue, 24 Nov 2020 00:00:00 +0000</pubDate>
      
      <guid>/publication/biorxiv_beemstatic/</guid>
      <description></description>
    </item>
    
    <item>
      <title>Atopic Dermatitis Microbiomes Stratify into Ecologic Dermotypes Enabling Microbial Virulence and Disease Severity</title>
      <link>/publication/jaci_skin/</link>
      <pubDate>Thu, 08 Oct 2020 00:00:00 +0000</pubDate>
      
      <guid>/publication/jaci_skin/</guid>
      <description></description>
    </item>
    
    <item>
      <title>Krakenæ‹“å±•å·¥å…·KrakenTools</title>
      <link>/post/2020-08-22-krakentools/</link>
      <pubDate>Sat, 22 Aug 2020 00:00:00 +0000</pubDate>
      
      <guid>/post/2020-08-22-krakentools/</guid>
      <description>


&lt;div id=&#34;èƒŒæ™¯&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;èƒŒæ™¯&lt;/h2&gt;
&lt;p&gt;Krakenï¼ˆKraken2ï¼‰é»˜è®¤çš„reportæ ¼å¼å¹¶ä¸åˆ©äºåç»­çš„åˆ†æï¼Œåœ¨è¿è¡ŒKrakenæ—¶æˆ‘é€šå¸¸ä¼šä½¿ç”¨&lt;code&gt;--use-mpa-style&lt;/code&gt;è¿™ä¸ªå‚æ•°æ¥ç”ŸæˆåƒMetaPhlanï¼ˆMetaPhlan2ï¼‰æ ¼å¼çš„ç»“æœã€‚ä½†æ˜¯å¦‚æœæƒ³è¦åšåç»­çš„åˆ†æï¼ˆBrackenï¼‰ï¼Œå°±è¿˜è¦ç”¨åˆ°reportæ ¼å¼çš„ç»“æœã€‚ä¹‹å‰æˆ‘é‡‡ç”¨çš„ç­–ç•¥æ˜¯&lt;a href=&#34;https://lichenhao.netlify.app/post/2019-10-17-nextflow-kraken/&#34;&gt;è¿è¡Œä¸¤æ¬¡Kraken2&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;pre class=&#34;sh&#34;&gt;&lt;code&gt;### run it twice...
kraken2 \
    --db $KRAKEN_DB \
    --paired \
    --threads 8 \
    --output ${prefix}.out \
    --report ${prefix}.kraken2.tsv \
    $fq1 $fq2 \
    --use-mpa-style

### run again for bracken
kraken2 \
    --db $KRAKEN_DB \
    --paired \
    --threads 8 \
    --report ${prefix}.kraken2 \
    $fq1 $fq2 &amp;gt; /dev/null&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç»éªŒä¸Šæ¥è®²Krakenå¾ˆå¤§ä¸€éƒ¨åˆ†è¿è¡Œæ—¶é—´èŠ±åœ¨å°†æ•°æ®åº“è½½å…¥å†…å­˜å’Œç¡¬ç›˜è¯»å†™ï¼ˆIOï¼‰ï¼Œå¯¹äºå¤§æ•°æ®åº“ã€æ·±åº¦æµ‹åºï¼Œä¼šé€ æˆä¸€å®šçš„èµ„æºæµªè´¹ã€å¹¶ä¸”CPUåˆ©ç”¨ç‡ä¸é«˜ã€‚&lt;/p&gt;
&lt;p&gt;æœ€è¿‘å‘ç°äº†Brackençš„ä½œè€…å¼€å‘çš„&lt;a href=&#34;https://github.com/jenniferlu717/KrakenTools&#34;&gt;å¾ˆæœ‰ç”¨çš„å·¥å…·é›†&lt;/a&gt;ã€‚å…¶ä¸­åŒ…å«ä¸€ä¸ªå°†Kraken reportæ ¼å¼è½¬æ¢ä¸ºmpaæ ¼å¼çš„è¾“å‡ºçš„è„šæœ¬&lt;code&gt;kreport2mpa.py&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;ä½¿ç”¨kreport2mpa.pyç®€åŒ–krakenæµç¨‹&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;ä½¿ç”¨&lt;code&gt;kreport2mpa.py&lt;/code&gt;ç®€åŒ–krakenæµç¨‹&lt;/h2&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ç®€åŒ–åçš„Kraken2æµç¨‹ï¼š&lt;/p&gt;
&lt;pre class=&#34;sh&#34;&gt;&lt;code&gt;kraken2 \
    --db $KRAKEN_DB \
    --paired \
    --threads 8 \
    --output ${prefix}.kraken2.out \
    --report ${prefix}.kraken2.report \
    $reads1 $reads2 
    ### Convert kraken report to mpa file
kreport2mpa.py \
     -r ${prefix}.kraken2.report \
     -o ${prefix}.kraken2.tax \
     --no-intermediate-ranks&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;shotgunmetagenomics-nfæµç¨‹çš„develop branchå·²ç»æ›´æ–°äº†å¯¹åº”çš„&lt;a href=&#34;https://github.com/lch14forever/shotgunmetagenomics-nf/blob/develop/modules/profilers_kraken2_bracken.nf&#34;&gt;module&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;ä½¿ç”¨extract_kraken_reads.pyæå–å¯¹åº”taxidçš„åºåˆ—&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;ä½¿ç”¨&lt;code&gt;extract_kraken_reads.py&lt;/code&gt;æå–å¯¹åº”TaxIDçš„åºåˆ—&lt;/h2&gt;
&lt;p&gt;è¿™ä¸ªç¨‹åºå¯ä»¥ç”¨æ¥å¿«é€Ÿè¿‡æ»¤å‡ºå±äºä¸€ä¸ªç‰©ç§ï¼ˆæˆ–å…¶ä»–åˆ†ç±»ç­‰çº§ï¼‰çš„åºåˆ—ã€‚&lt;/p&gt;
&lt;pre class=&#34;sh&#34;&gt;&lt;code&gt;## æå–E. coliåºåˆ—
extract_kraken_reads.py \
    -t 562 \ 
    -k ${prefix}.kraken2.report \
    -s1 $reads1 -s2 $reads2 \
    -o $extracted1 -o2 $extracted2 \
    --fastq-output&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;å‚è€ƒ&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;å‚è€ƒ&lt;/h2&gt;
&lt;p&gt;KrakenTools: &lt;a href=&#34;https://github.com/jenniferlu717/KrakenTools&#34; class=&#34;uri&#34;&gt;https://github.com/jenniferlu717/KrakenTools&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>Cartography of opportunistic pathogens and antibiotic resistance genes in a tertiary hospital environment</title>
      <link>/publication/naturemedicine_hospital/</link>
      <pubDate>Sun, 31 May 2020 00:00:00 +0000</pubDate>
      
      <guid>/publication/naturemedicine_hospital/</guid>
      <description></description>
    </item>
    
    <item>
      <title>åŸºäºNextflowçš„å®åŸºå› ç»„æœ‰å‚åˆ†æ-VI Nextflow toweræœ¬åœ°é…ç½®</title>
      <link>/post/2019-10-29-nextflow-tower-deploy/</link>
      <pubDate>Tue, 29 Oct 2019 00:00:00 +0000</pubDate>
      
      <guid>/post/2019-10-29-nextflow-tower-deploy/</guid>
      <description>


&lt;div id=&#34;æµ‹è¯•ç¯å¢ƒ&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;æµ‹è¯•ç¯å¢ƒ&lt;/h3&gt;
&lt;p&gt;Ubuntu 18.04 ï¼ˆRootæƒé™ï¼‰&lt;/p&gt;
&lt;p&gt;AWSå®‰å…¨ç»„é…ç½®ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr class=&#34;header&#34;&gt;
&lt;th&gt;Custom TCP&lt;/th&gt;
&lt;th&gt;TCP&lt;/th&gt;
&lt;th&gt;8000&lt;/th&gt;
&lt;th&gt;0.0.0.0/0&lt;/th&gt;
&lt;th&gt;ss&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr class=&#34;odd&#34;&gt;
&lt;td&gt;Custom TCP&lt;/td&gt;
&lt;td&gt;TCP&lt;/td&gt;
&lt;td&gt;8000&lt;/td&gt;
&lt;td&gt;::/0&lt;/td&gt;
&lt;td&gt;ss&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;div id=&#34;å®‰è£…jdk1.8åŠç¼–è¯‘ä¾èµ–&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;å®‰è£…jdkï¼ˆ&amp;gt;1.8ï¼‰åŠç¼–è¯‘ä¾èµ–&lt;/h3&gt;
&lt;pre class=&#34;sh&#34;&gt;&lt;code&gt;sudo apt update
sudo apt install openjdk-8-jdk-headless
sudo apt install build-essential&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;å®‰è£…dockerdocker-compose&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;å®‰è£…dockerï¼Œdocker-compose&lt;/h3&gt;
&lt;pre class=&#34;sh&#34;&gt;&lt;code&gt;sudo apt install docker.io
sudo curl -L &amp;quot;https://github.com/docker/compose/releases/download/1.24.1/docker-compose-$(uname -s)-$(uname -m)&amp;quot; -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;æ›´æ”¹dockeræƒé™æ­¤å¤„éœ€è¦ç™»å‡ºå¹¶é‡æ–°ç™»é™†&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;æ›´æ”¹dockeræƒé™ï¼ˆæ­¤å¤„éœ€è¦ç™»å‡ºå¹¶é‡æ–°ç™»é™†ï¼‰&lt;/h3&gt;
&lt;pre class=&#34;sh&#34;&gt;&lt;code&gt;sudo usermod -a -G docker $USER&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;ä¸‹è½½nf-tower&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;ä¸‹è½½nf-tower&lt;/h3&gt;
&lt;pre class=&#34;sh&#34;&gt;&lt;code&gt;## install git
sudo apt install git
git clone https://github.com/seqeralabs/nf-tower&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;é…ç½®ç¯å¢ƒå˜é‡&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;é…ç½®ç¯å¢ƒå˜é‡&lt;/h3&gt;
&lt;p&gt;æ­¤å¤„éœ€è¦ç”³è¯·ä¸€ä¸ªå‘é‚®ä»¶çš„æœåŠ¡å™¨ï¼Œnfæ¨èäº†https://sendgrid.com&lt;/p&gt;
&lt;p&gt;åœ¨å·¦ä¾§é€‰é¡¹æ ç‚¹å‡»&lt;code&gt;Settings&lt;/code&gt;â€“&amp;gt;&lt;code&gt;APIKeys&lt;/code&gt;â€“&amp;gt;&lt;code&gt;Create API Key&lt;/code&gt;â€“&amp;gt;è¾“å…¥key nameå¹¶é€‰æ‹©Full Access
ç‚¹å‡»ç”Ÿæˆçš„ç§˜é’¥ç›´æ¥æ‹·è´åˆ°å‰ªåˆ‡æ¿ï¼Œå¦‚â€œSG.dsVDEPp9SCOJFxe8QObVcAxxxxxxxxxxxxxâ€&lt;/p&gt;
&lt;p&gt;ç¼–è¾‘é…ç½®æ–‡ä»¶&lt;code&gt;nf-tower/tower-backend/src/main/resources/application.yml&lt;/code&gt;&lt;/p&gt;
&lt;pre class=&#34;sh&#34;&gt;&lt;code&gt;...
  smtp:
    host: &amp;quot;smtp.sendgrid.net&amp;quot;
    port: &amp;quot;587&amp;quot;
    auth: &amp;quot;${TOWER_SMTP_AUTH:true}&amp;quot;
    user: &amp;quot;apikey&amp;quot;
    password: &amp;quot;SG.dsVDEPp9SCOJFxe8QObVcAxxxxxxxxxxxxx&amp;quot;
...&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;ç¼–è¯‘tower&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;ç¼–è¯‘tower&lt;/h3&gt;
&lt;pre class=&#34;sh&#34;&gt;&lt;code&gt;make build
make run&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;ä½¿ç”¨nextflow-tower&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;ä½¿ç”¨Nextflow Tower&lt;/h3&gt;
&lt;p&gt;ä½¿ç”¨æ–¹æ³•åŸºæœ¬ä¸tower.nfç½‘ç«™ä¸€è‡´ã€‚æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œå¦‚æœnextflowéƒ¨ç½²åœ¨æœåŠ¡å™¨ä¸Šï¼Œéœ€è¦ä¿®æ”¹é‚®ä»¶ä¸­çš„é“¾æ¥åœ°å€ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é‚®ä»¶ä¸­é“¾æ¥ä¸ºï¼š&lt;a href=&#34;http://&#34; class=&#34;uri&#34;&gt;http://&lt;/a&gt;&lt;strong&gt;localhost&lt;/strong&gt;:8000/auth?uid=xxxx&lt;/li&gt;
&lt;li&gt;ä¿®æ”¹ä¸ºï¼š&lt;a href=&#34;http://&#34; class=&#34;uri&#34;&gt;http://&lt;/a&gt;&lt;strong&gt;æœåŠ¡å™¨åœ°å€&lt;/strong&gt;:8000/auth?uid=xxxx&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;(æœªå®Œ)&lt;/p&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>åŸºäºNextflowçš„å®åŸºå› ç»„æœ‰å‚åˆ†æ-V Nextflow tower</title>
      <link>/post/2019-10-25-nextflow-tower/</link>
      <pubDate>Fri, 25 Oct 2019 00:00:00 +0000</pubDate>
      
      <guid>/post/2019-10-25-nextflow-tower/</guid>
      <description>


&lt;p&gt;ç™»å½•Nextflow Towerçš„&lt;a href=&#34;tower.nf&#34;&gt;å®˜æ–¹ç½‘ç«™&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ç‚¹å‡»â€œSign inâ€å¹¶è¾“å…¥é‚®ç®±ï¼Œä¼šåœ¨é‚®ç®±ä¸­æ”¶åˆ°ç™»å½•é“¾æ¥&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;nextflow-login.png&#34; /&gt;&lt;/p&gt;
&lt;p&gt;ç™»é™†åçœ‹åˆ°å¦‚ä¸‹ç•Œé¢&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;nextflow-token.png&#34; /&gt;&lt;/p&gt;
&lt;p&gt;åœ¨è¿è¡Œnextflowå‰è®¾ç½®ç¯å¢ƒå˜é‡&lt;/p&gt;
&lt;pre class=&#34;sh&#34;&gt;&lt;code&gt;$ export TOWER_ACCESS_TOKEN=xxxxxxxxxxxxxxxxxxxxxxx&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åœ¨è¿è¡Œä¸Šä¸€ç¯‡çš„æµç¨‹æ—¶ï¼ŒåŠ å…¥&lt;code&gt;-with-tower&lt;/code&gt;å‚æ•°&lt;/p&gt;
&lt;pre class=&#34;sh&#34;&gt;&lt;code&gt;$ ./main.nf --read_path data -with-tower

N E X T F L O W  ~  version 19.09.0-edge
Launching `./main.nf` [angry_venter] - revision: 72dddbcd1f
WARN: DSL 2 IS AN EXPERIMENTAL FEATURE UNDER DEVELOPMENT -- SYNTAX MAY CHANGE IN FUTURE RELEASE
Monitor the execution with Nextflow Tower using this url https://tower.nf/watch/xxxxxx
executor &amp;gt;  local (8)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä½¿ç”¨ä¸Šé¢çš„é“¾æ¥æˆ–ç™»å½•Nextflow Towerä¾¿å¯å®æ—¶ç›‘æ§æµç¨‹çš„è¿è¡Œ&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;nextflow-tower.png&#34; /&gt;&lt;/p&gt;
&lt;p&gt;è¿è¡Œå®Œæˆåå¯ä»¥æŸ¥çœ‹æµç¨‹ä½¿ç”¨èµ„æºçš„æƒ…å†µ&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;nextflow-finish.png&#34; /&gt;&lt;/p&gt;
&lt;p&gt;(æœªå®Œ)&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>åŸºäºNextflowçš„å®åŸºå› ç»„æœ‰å‚åˆ†æ-IV Kraken2&#43;Bracken</title>
      <link>/post/2019-10-17-nextflow-kraken/</link>
      <pubDate>Thu, 17 Oct 2019 00:00:00 +0000</pubDate>
      
      <guid>/post/2019-10-17-nextflow-kraken/</guid>
      <description>


&lt;div id=&#34;shell&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Shellè„šæœ¬&lt;/h2&gt;
&lt;p&gt;å’Œfastp+decontçš„æ­¥éª¤ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥é¦–å…ˆå°†æµç¨‹å†™æˆä¸€ä¸ªshellè„šæœ¬ï¼š&lt;/p&gt;
&lt;pre class=&#34;sh&#34;&gt;&lt;code&gt;#!/bin/bash
set -e -o pipefail
source activate metagenomics

fq1=$1
fq2=$2
prefix=$3
KRAKEN_DB=/data/minikraken2_v2_8GB 

### run it twice...
kraken2 \
    --db $KRAKEN_DB \
    --paired \
    --threads 8 \
    --output ${prefix}.out \
    --report ${prefix}.kraken2.tsv \
    $fq1 $fq2 \
    --use-mpa-style

### run again for bracken
kraken2 \
    --db $KRAKEN_DB \
    --paired \
    --threads 8 \
    --report ${prefix}.kraken2 \
    $fq1 $fq2 &amp;gt; /dev/null


for tax in s g;
do
bracken -d ${KRAKEN_DB} \
    -i ${prefix}.kraken2 \
    -o ${prefix}.bracken.${tax} \
    -l ${tax^^}

sed &amp;#39;s/ /_/g&amp;#39; ${prefix}.bracken.${tax} | \
    tail -n+2 | \
    cut -f 1,7 &amp;gt; ${prefix}.${tax}
done&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åœ¨ä¸Šé¢çš„è„šæœ¬é‡Œé¢ï¼Œä¸ºäº†è·å–mpaï¼ˆMetaPhlAnï¼‰æ ¼å¼çš„è¾“å‡ºï¼Œæˆ‘è¿è¡Œäº†ä¸¤æ¬¡Kraken2ï¼Œç¬¬ä¸€æ¬¡ç”Ÿæˆmpaæ ¼å¼çš„åˆ†ç±»è°±ï¼Œç¬¬äºŒæ¬¡ç”ŸæˆBrackenæ‰€éœ€è¦çš„reportæ ¼å¼ã€‚Kraken2çš„å‚è€ƒæ•°æ®åº“ï¼ˆå«Brackenå‚è€ƒï¼‰å¯ä»å®˜æ–¹&lt;a href=&#34;https://ccb.jhu.edu/software/kraken2/downloads.shtml&#34;&gt;FTP&lt;/a&gt;ä¸‹è½½ã€‚&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;nextflow&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Nextflowæ¨¡å—&lt;/h2&gt;
&lt;p&gt;å°†ä¸Šé¢çš„è„šæœ¬å†™æˆä¸€ä¸ªnextflowæ¨¡å—kraken2.nfï¼š&lt;/p&gt;
&lt;pre class=&#34;groovy&#34;&gt;&lt;code&gt;params.outdir = &amp;#39;./&amp;#39;

process KRAKEN2 {
    tag &amp;quot;${prefix}&amp;quot;
    cpus 8
    publishDir params.outdir, mode: &amp;#39;copy&amp;#39;

    input:
    file index_path
    tuple prefix, file(reads1), file(reads2)

    output:
    tuple prefix, file(&amp;quot;${prefix}.kraken2.report&amp;quot;)
    tuple prefix, file(&amp;quot;${prefix}.kraken2.tax&amp;quot;)
    file &amp;quot;${prefix}.kraken2.out&amp;quot;

    script:
    &amp;quot;&amp;quot;&amp;quot;
    kraken2 \\
    --db $index_path \\
    --paired \\
    --threads $task.cpus \\
    --output ${prefix}.kraken2.out \\
    --report ${prefix}.kraken2.tax \\
    $reads1 $reads2 \\
    --use-mpa-style \\

    ### run again for bracken
    kraken2 \\
    --db $index_path \\
    --paired \\
    --threads $task.cpu \\
    --report ${prefix}.kraken2.report \\
    $reads1 $reads2 \\
    --output -
    &amp;quot;&amp;quot;&amp;quot;
}

process BRACKEN {
    tag &amp;quot;${prefix}&amp;quot;
    publishDir params.outdir, mode: &amp;#39;copy&amp;#39;

    input:
    file index_path  // This must have the bracken database
    tuple prefix, file(kraken2_report)
    each tax

    output:
    file &amp;quot;${prefix}*.tsv&amp;quot;

    script:
    &amp;quot;&amp;quot;&amp;quot;
    TAX=$tax; \\

    bracken -d $index_path \\
    -i $kraken2_report \\
    -o ${prefix}.bracken.${tax} \\
    -l \${TAX^^}; \\

    sed &amp;#39;s/ /_/g&amp;#39; ${prefix}.bracken.${tax} | \\
    tail -n+2 | \\
    cut -f 1,7 &amp;gt; ${prefix}.bracken.${tax}.tsv
    &amp;quot;&amp;quot;&amp;quot;
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å…¶ä¸­&lt;code&gt;each&lt;/code&gt;ç›¸å½“äºä¸Šé¢è„šæœ¬çš„&lt;code&gt;for&lt;/code&gt;å¾ªç¯ï¼Œå¯¹äºä¸åŒçš„åˆ†ç±»&lt;code&gt;s&lt;/code&gt;ï¼ˆspeciesï¼‰ï¼Œ&lt;code&gt;g&lt;/code&gt;ï¼ˆgenusï¼‰åˆ†åˆ«è¿è¡Œbrackenã€‚&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;section level2&#34;&gt;
&lt;h2&gt;ä¸»è„šæœ¬ä¸­è°ƒç”¨æ¨¡å—&lt;/h2&gt;
&lt;p&gt;æ¥ä¸Šä¸€ç¯‡ä¸­çš„ä¸»è„šæœ¬ï¼ˆ&lt;code&gt;main.nf&lt;/code&gt;ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨DECONTè¿‡ç¨‹çš„ç»“æœä½œä¸ºKraken2+Brackençš„è¾“å…¥ï¼š&lt;/p&gt;
&lt;pre class=&#34;groovy&#34;&gt;&lt;code&gt;#!/usr/bin/env nextflow

// DSL 2 syntax
nextflow.preview.dsl=2

// parameters
params.help = false
params.read_path  = &amp;quot;${workflow.projectDir}/data&amp;quot;

// parameters decont
params.decont_refpath = &amp;#39;/data/nucleotide/&amp;#39;
params.decont_index   = &amp;#39;hg19.fa&amp;#39;
params.decont_outdir  = &amp;#39;./pipeline_output/decont_out&amp;#39;
ch_bwa_idx = file(params.decont_refpath)
// parameters kraken2                                              // ***
params.kraken2_refpath = &amp;#39;/data/minikraken2_v2_8GB_201904_UPDATE/&amp;#39; // ***
params.kraken2_outdir = &amp;#39;./pipeline_output/kraken2_out&amp;#39;            // ***
ch_kraken_idx = file(params.kraken2_refpath)                       // ***

include &amp;#39;./decont&amp;#39; params(index: &amp;quot;$params.decont_index&amp;quot;, outdir: &amp;quot;$params.decont_outdir&amp;quot;)
include &amp;#39;./kraken2&amp;#39; params(outdir: &amp;quot;$params.kraken2_outdir&amp;quot;)       // ***


// help message
def helpMessage() {
    log.info&amp;quot;&amp;quot;&amp;quot;
    =================================================================
    Usage: ${workflow.projectDir}/main.nf --read_path PATH/OF/READS
    =================================================================
    &amp;quot;&amp;quot;&amp;quot;.stripIndent()
}
if (params.help){
    helpMessage()
    exit 0
}

// Create channel for reads
ch_reads = Channel
    .fromFilePairs(params.read_path + &amp;#39;/**{1,2}.f*q*&amp;#39;, flat: true)

workflow{
    DECONT(ch_bwa_idx, ch_reads)
    KRAKEN2(ch_kraken_idx, DECONT.out[0])                          // ***
    BRACKEN(ch_kraken_idx, KRAKEN2.out[0], Channel.from(&amp;#39;s&amp;#39;, &amp;#39;g&amp;#39;)) // ***
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åŠ å…¥&lt;code&gt;// ***&lt;/code&gt;çš„éƒ¨åˆ†ä¸ºæ·»åŠ çš„å†…å®¹&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;section level2&#34;&gt;
&lt;h2&gt;é€è¡Œè§£æ&lt;/h2&gt;
&lt;div class=&#34;section level3&#34;&gt;
&lt;h3&gt;é…ç½®å‚æ•°&lt;/h3&gt;
&lt;pre class=&#34;groovy&#34;&gt;&lt;code&gt;// parameters kraken2                                              // ***
params.kraken2_refpath = &amp;#39;/data/minikraken2_v2_8GB_201904_UPDATE/&amp;#39; // ***
params.kraken2_outdir = &amp;#39;./pipeline_output/kraken2_out&amp;#39;            // ***
ch_kraken_idx = file(params.kraken2_refpath)                       // ***&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ­¤å¤„äºDECONTè¿‡ç¨‹çš„é…ç½®ç±»ä¼¼ï¼Œè¿™é‡Œå‡è®¾Brackençš„ç´¢å¼•å’ŒKraken2çš„ç´¢å¼•åœ¨åŒä¸€ä¸ªç›®å½•ä¸‹ã€‚&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;section level3&#34;&gt;
&lt;h3&gt;å¼•ç”¨æ¨¡å—&lt;/h3&gt;
&lt;pre class=&#34;groovy&#34;&gt;&lt;code&gt;include &amp;#39;./kraken2&amp;#39; params(outdir: &amp;quot;$params.kraken2_outdir&amp;quot;)      // ***&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ­¤å¤„ä¸DECONTè¿‡ç¨‹çš„é…ç½®ç±»ä¼¼&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;section level3&#34;&gt;
&lt;h3&gt;æµç¨‹å®šä¹‰&lt;/h3&gt;
&lt;pre class=&#34;groovy&#34;&gt;&lt;code&gt;workflow{
    DECONT(ch_bwa_idx, ch_reads)
    KRAKEN2(ch_kraken_idx, DECONT.out[0])                          // ***
    BRACKEN(ch_kraken_idx, KRAKEN2.out[0], Channel.from(&amp;#39;s&amp;#39;, &amp;#39;g&amp;#39;)) // ***
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åœ¨ä¸Šä¸€ç¯‡åšæ–‡ï¼ŒDECONTçš„è¾“å‡ºè¢«å®šä¹‰ä¸ºä¸¤ä¸ªtupleï¼š&lt;/p&gt;
&lt;pre class=&#34;groovy&#34;&gt;&lt;code&gt;output:
    tuple prefix, file(&amp;quot;${prefix}*1.fastq.gz&amp;quot;), file(&amp;quot;${prefix}*2.fastq.gz&amp;quot;)
    tuple file(&amp;quot;${prefix}.html&amp;quot;), file(&amp;quot;${prefix}.json&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç¬¬ä¸€ä¸ªtupleä¸ºå»å®¿ä¸»DNAä¹‹åçš„fastqæ–‡ä»¶ï¼Œç¬¬äºŒä¸ªä¸ºfastpçš„è´¨æ§æ–‡ä»¶ï¼Œè¿è¡ŒKRAKENè¿‡ç¨‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä»¥&lt;code&gt;DECONT.out[0]&lt;/code&gt;æ¥ä½¿ç”¨DECONTè¿‡ç¨‹ç»“æœçš„ç¬¬ä¸€ä¸ªtupleã€‚åŒæ ·çš„ï¼Œåœ¨BRACKENè¿‡ç¨‹è°ƒç”¨æ—¶ï¼Œæˆ‘ä»¬ä»¥&lt;code&gt;KRAKEN2.out[0]&lt;/code&gt;æ¥ä½¿ç”¨KRAKEN2è¿‡ç¨‹ç»“æœçš„ç¬¬ä¸€ä¸ªtuple&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;section level2&#34;&gt;
&lt;h2&gt;æ‰§è¡Œ&lt;/h2&gt;
&lt;pre class=&#34;sh&#34;&gt;&lt;code&gt;$ ls data
$ ./main.nf
N E X T F L O W  ~  version 19.09.0-edge
Launching `./main.nf` [jolly_heyrovsky] - revision: b913fda572
WARN: DSL 2 IS AN EXPERIMENTAL FEATURE UNDER DEVELOPMENT -- SYNTAX MAY CHANGE IN FUTURE RELEASE
executor &amp;gt;  local (8)
[6f/7c66ef] process &amp;gt; DECONT (SRR1950773)  [100%] 2 of 2 âœ”
[51/9f4f92] process &amp;gt; KRAKEN2 (SRR1950773) [100%] 2 of 2 âœ”
[c7/603e5e] process &amp;gt; BRACKEN (SRR1950772) [100%] 4 of 4 âœ”
Completed at: 17-Oct-2019 12:57:14
Duration    : 3m 50s
CPU hours   : 0.5
Succeeded   : 8&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æŸ¥çœ‹ç»“æœï¼š&lt;/p&gt;
&lt;pre class=&#34;sh&#34;&gt;&lt;code&gt;$ ls pipeline_output/kraken2_out/
SRR1950772.bracken.g.tsv  SRR1950772.kraken2.out     SRR1950772.kraken2.tax    SRR1950773.bracken.s.tsv  SRR1950773.kraken2.report
SRR1950772.bracken.s.tsv  SRR1950772.kraken2.report  SRR1950773.bracken.g.tsv  SRR1950773.kraken2.out    SRR1950773.kraken2.tax&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å‚è€ƒï¼š
&lt;a href=&#34;https://www.nextflow.io/docs/latest/&#34; class=&#34;uri&#34;&gt;https://www.nextflow.io/docs/latest/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;(æœªå®Œ)&lt;/p&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>åŸºäºNextflowçš„å®åŸºå› ç»„æœ‰å‚åˆ†æ-III è´¨æ§&#43;å»å®¿ä¸»DNA</title>
      <link>/post/2019-10-01-nextflow-decont/</link>
      <pubDate>Tue, 01 Oct 2019 00:00:00 +0000</pubDate>
      
      <guid>/post/2019-10-01-nextflow-decont/</guid>
      <description>


&lt;div id=&#34;shell&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Shellè„šæœ¬&lt;/h2&gt;
&lt;p&gt;è´¨æ§å’Œå»å®¿ä¸»ä¸»è¦ç”±ä»¥ä¸‹å·¥å…·å®Œæˆï¼š&lt;/p&gt;
&lt;ol style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;fastp: å»æ¥å¤´ï¼Œä¿®å‰ªä½è´¨é‡åºåˆ—&lt;/li&gt;
&lt;li&gt;BWA + samtoolsï¼šå»å®¿ä¸»&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å‚ç…§è¿™ç¯‡&lt;a href=&#34;http://www.metagenomics.wiki/tools/short-read/remove-host-sequences&#34;&gt;æ•™ç¨‹&lt;/a&gt;ï¼Œæˆ‘ä»¬å¯ä»¥è®¾è®¡å¦‚ä¸‹ç®€å•çš„æµç¨‹ï¼š&lt;/p&gt;
&lt;pre class=&#34;sh&#34;&gt;&lt;code&gt;#!/bin/bash

## requirement:
## fastp, BWA, samtools &amp;gt;= 1.7

ref=$1
reads1=$2
reads2=$3
prefix=$4
threads=${5:-4}

fastp -i $reads1 -I $reads2 --stdout -j ${prefix}.json -h ${prefix}.html | 
    bwa mem -p -t $threads $ref - | 
    samtools fastq -f12 -F256  -1  ${prefix}_fastpdecont_1.fastq.gz -2 ${prefix}_fastpdecont_2.fastq.gz -&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ­¤å¤„å°½å¯èƒ½åœ°ä½¿ç”¨ç®¡é“æ¥é¿å…ç¡¬ç›˜è¯»å†™å’Œä¸å¿…è¦çš„æ•°æ®å­˜å‚¨ã€‚&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;nextflow&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;Nextflowæ¨¡å—&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥æŠŠä»¥ä¸Šè„šæœ¬å†™æˆç®€å•çš„nextflowæ¨¡å—decont.nfï¼š&lt;/p&gt;
&lt;pre class=&#34;groovy&#34;&gt;&lt;code&gt;params.index = &amp;#39;hg19.fa&amp;#39;
params.outdir = &amp;#39;./&amp;#39;

process DECONT {
    tag &amp;quot;${prefix}&amp;quot;
    cpus 8
    publishDir params.outdir, mode: &amp;#39;copy&amp;#39;

    input:
    file index_path
    tuple prefix, file(reads1), file(reads2)

    output:
    tuple prefix, file(&amp;quot;${prefix}*1.fastq.gz&amp;quot;), file(&amp;quot;${prefix}*2.fastq.gz&amp;quot;)
    tuple file(&amp;quot;${prefix}.html&amp;quot;), file(&amp;quot;${prefix}.json&amp;quot;)

    script:
    &amp;quot;&amp;quot;&amp;quot;
    fastp -i $reads1 -I $reads2 --stdout -j ${prefix}.json -h ${prefix}.html | \\
    bwa mem -p -t $task.cpus ${index_path}/${params.index} - | \\
    samtools fastq -f12 -F256  -1  ${prefix}_fastpdecont_1.fastq.gz -2 ${prefix}_fastpdecont_2.fastq.gz -
    &amp;quot;&amp;quot;&amp;quot;
}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div class=&#34;section level2&#34;&gt;
&lt;h2&gt;é€è¡Œè§£æ&lt;/h2&gt;
&lt;div class=&#34;section level3&#34;&gt;
&lt;h3&gt;æ¨¡å—å‚æ•°:&lt;/h3&gt;
&lt;pre class=&#34;groovy&#34;&gt;&lt;code&gt;params.index = &amp;#39;hg19.fa&amp;#39;
params.outdir = &amp;#39;./&amp;#39;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å’Œä¸Šä¸€ç¯‡ä»‹ç»çš„æµç¨‹å‚æ•°ä¸€è‡´ï¼Œå®šä¹‰äº†åœ¨è¯¥æ¨¡å—çš„å‚æ•°ï¼ˆæˆ‘æ¨æµ‹è¿™äº›å‚æ•°çš„scopeæ˜¯localï¼Œå³ä»…é™äºè¯¥æ¨¡å—ï¼Œæœ‰å¾…ç¡®å®šï¼‰ã€‚&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;section level3&#34;&gt;
&lt;h3&gt;è¿‡ç¨‹å®šä¹‰ï¼š&lt;/h3&gt;
&lt;pre class=&#34;groovy&#34;&gt;&lt;code&gt;process DECONT {
    input:
    ...
    output:
    ...
    script:
    ...
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä»¥ä¸Šä¸ºNextflowè¿‡ç¨‹(process)çš„éª¨æ¶ç»“æ„ï¼Œä¸»è¦ç”±è¾“å…¥(input)ï¼Œè¾“å‡º(output)ï¼Œè„šæœ¬(script)æ¥æ„æˆã€‚&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;section level3&#34;&gt;
&lt;h3&gt;è¿‡ç¨‹æŒ‡ä»¤ï¼š&lt;/h3&gt;
&lt;pre class=&#34;groovy&#34;&gt;&lt;code&gt;tag &amp;quot;${prefix}&amp;quot;
cpus 8
publishDir params.outdir, mode: &amp;#39;copy&amp;#39;&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;tag&lt;/code&gt;ï¼šç»™æ¯ä¸€ä¸ªè¿‡ç¨‹æ‰§è¡Œå‘½åï¼Œæ–¹ä¾¿åœ¨æ‰§è¡Œæ—¥å¿—ä¸­æŸ¥çœ‹&lt;/li&gt;
&lt;li&gt;&lt;code&gt;cpus&lt;/code&gt;ï¼šæ­¤è¿‡ç¨‹è¿è¡Œæ—¶çš„CPUæ•°é‡&lt;/li&gt;
&lt;li&gt;&lt;code&gt;publishDir&lt;/code&gt;ï¼šç»“æœå‘å¸ƒè·¯å¾„ï¼Œè¿è¡Œå®Œæˆåå°†æœ€ç»ˆçš„ç»“æœï¼ˆç”±&lt;code&gt;output&lt;/code&gt;å®šä¹‰ï¼‰æ‹·è´ï¼ˆ&lt;code&gt;&#39;copy&#39;&lt;/code&gt;ï¼‰åˆ°è¯¥è·¯å¾„&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ›´å¤šçš„æŒ‡ä»¤å»ºè®®å‚è€ƒNextflowçš„&lt;a href=&#34;https://www.nextflow.io/docs/latest/process.html#directives&#34;&gt;å®˜æ–¹æ–‡æ¡£&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;section level3&#34;&gt;
&lt;h3&gt;è¾“å…¥ã€è¾“å‡ºï¼š&lt;/h3&gt;
&lt;pre class=&#34;groovy&#34;&gt;&lt;code&gt;input:
    file index_path
    tuple prefix, file(reads1), file(reads2)

output:
    tuple prefix, file(&amp;quot;${prefix}*1.fastq.gz&amp;quot;), file(&amp;quot;${prefix}*2.fastq.gz&amp;quot;)
    tuple file(&amp;quot;${prefix}.html&amp;quot;), file(&amp;quot;${prefix}.json&amp;quot;)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ç”±å…³é”®å­—&lt;code&gt;input:&lt;/code&gt;æˆ–&lt;code&gt;output:&lt;/code&gt;(æ³¨æ„å†’å·)æ„æˆï¼Œåé¢æ¥å†…å®¹(å…¨éƒ½ä¸º&lt;code&gt;Channel&lt;/code&gt;ç±»å‹)ã€‚å†…å®¹å¯åŒ…å«ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å€¼(&lt;code&gt;val&lt;/code&gt;)ï¼šå¯çœç•¥&lt;/li&gt;
&lt;li&gt;æ–‡ä»¶(&lt;code&gt;file&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;åˆ—è¡¨(&lt;code&gt;tuple&lt;/code&gt;)ï¼šå½¢å¼ä¸º&lt;code&gt;[element1, element2, elemnet3, ...]&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ³¨ï¼šä¼¼ä¹åœ¨Nextflowæ–‡æ¡£ä¸­&lt;code&gt;tuple&lt;/code&gt;å’Œ&lt;code&gt;list&lt;/code&gt;ç­‰åŒã€‚&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;section level3&#34;&gt;
&lt;h3&gt;è„šæœ¬&lt;/h3&gt;
&lt;pre class=&#34;groovy&#34;&gt;&lt;code&gt;script:
    &amp;quot;&amp;quot;&amp;quot;
    fastp -i $reads1 -I $reads2 --stdout -j ${prefix}.json -h ${prefix}.html | \\
    bwa mem -p -t $task.cpus ${index_path}/${params.index} - | \\
    samtools fastq -f12 -F256  -1  ${prefix}_fastpdecont_1.fastq.gz -2 ${prefix}_fastpdecont_2.fastq.gz -
    &amp;quot;&amp;quot;&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Nextflowè¿‡ç¨‹çš„è„šæœ¬éƒ¨åˆ†ä¸ºShellè„šæœ¬ï¼Œæ³¨æ„Shellä¸­å˜é‡è¦ä½¿ç”¨&lt;code&gt;\$&lt;/code&gt;å¼€å¤´ã€‚è„šæœ¬éƒ¨åˆ†æ¶‰åŠçš„æ–‡ä»¶(æˆ–è·¯å¾„)å¿…é¡»æ˜¯Channelã€‚&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;section level2&#34;&gt;
&lt;h2&gt;åœ¨ä¸»è„šæœ¬ä¸­è°ƒç”¨æ¨¡å—&lt;/h2&gt;
&lt;p&gt;å»¶ç»­ä¸Šä¸€ç¯‡ä¸­çš„ä¸»è„šæœ¬(&lt;code&gt;main.nf&lt;/code&gt;)ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨DECONTè¿‡ç¨‹ï¼š&lt;/p&gt;
&lt;pre class=&#34;groovy&#34;&gt;&lt;code&gt;#!/usr/bin/env nextflow

// DSL 2 syntax
nextflow.preview.dsl=2

// parameters
params.help = false
params.read_path  = &amp;quot;${workflow.projectDir}/data&amp;quot;

// parameters decont                                                                       // ***
params.decont_refpath = &amp;#39;/data/nucleotide/&amp;#39;                                                // ***
params.decont_index   = &amp;#39;hg19.fa&amp;#39;                                                          // ***
params.decont_outdir  = &amp;#39;./pipeline_output/decont_out&amp;#39;                                     // ***
ch_bwa_idx = file(params.decont_refpath)                                                   // ***
include &amp;#39;./decont&amp;#39; params(index: &amp;quot;$params.decont_index&amp;quot;, outdir: &amp;quot;$params.decont_outdir&amp;quot;)  // ***


// help message
def helpMessage() {
    log.info&amp;quot;&amp;quot;&amp;quot;
    =================================================================
    Usage: ${workflow.projectDir}/main.nf --read_path PATH/OF/READS
    =================================================================
    &amp;quot;&amp;quot;&amp;quot;.stripIndent()
}
if (params.help){
    helpMessage()
    exit 0
}

// Create channel for reads
ch_reads = Channel
    .fromFilePairs(params.read_path + &amp;#39;/**{1,2}.f*q*&amp;#39;, flat: true)

workflow{                                                                                 // ***
    DECONT(ch_bwa_idx, ch_reads)                                                          // ***
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åŠ å…¥&lt;code&gt;// ***&lt;/code&gt;çš„éƒ¨åˆ†ä¸ºæ·»åŠ çš„å†…å®¹&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;-1&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;é€è¡Œè§£æ&lt;/h2&gt;
&lt;div id=&#34;decont&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;é…ç½®DECONTè¿‡ç¨‹å‚æ•°&lt;/h3&gt;
&lt;pre class=&#34;groovy&#34;&gt;&lt;code&gt;// parameters decont                                                                       // ***
params.decont_refpath = &amp;#39;/data/nucleotide/&amp;#39;                                                // ***
params.decont_index   = &amp;#39;hg19.fa&amp;#39;                                                          // ***
params.decont_outdir  = &amp;#39;./pipeline_output/decont_out&amp;#39;                                     // ***
ch_bwa_idx = file(params.decont_refpath)                                                   // ***&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æˆ‘ä»¬çŸ¥é“DECONTéƒ¨åˆ†éœ€è¦å››ä¸ªå‚æ•°ï¼š&lt;/p&gt;
&lt;ol style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;BWAç´¢å¼•è·¯å¾„&lt;/li&gt;
&lt;li&gt;BWAç´¢å¼•çš„å‰ç¼€&lt;/li&gt;
&lt;li&gt;DECONTè¾“å‡ºè·¯å¾„&lt;/li&gt;
&lt;li&gt;è¾“å…¥fastqæ–‡ä»¶ï¼š[prefix, r1.fastq, r2.fastq] (&lt;code&gt;tuple prefix, file(reads1), file(reads2)&lt;/code&gt;)&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„è¿™é‡ŒBWAç´¢å¼•è·¯å¾„éœ€è¦ä»¥Channelçš„å½¢å¼ä¼ å…¥&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;section level3&#34;&gt;
&lt;h3&gt;å¼•ç”¨æ¨¡å—&lt;/h3&gt;
&lt;pre class=&#34;groovy&#34;&gt;&lt;code&gt;include &amp;#39;./decont&amp;#39; params(index: &amp;quot;$params.decont_index&amp;quot;, outdir: &amp;quot;$params.decont_outdir&amp;quot;)  // ***&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;éæ–‡ä»¶æˆ–è·¯å¾„çš„å‚æ•°é€šè¿‡&lt;code&gt;params(param1:, param2:)&lt;/code&gt;ä¼ å…¥ã€‚&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;section level3&#34;&gt;
&lt;h3&gt;æµç¨‹å®šä¹‰&lt;/h3&gt;
&lt;pre class=&#34;groovy&#34;&gt;&lt;code&gt;workflow{                                                                                 // ***
    DECONT(ch_bwa_idx, ch_reads)                                                          // ***
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ‰§è¡Œæµç¨‹ï¼Œprocessæ‰€éœ€çš„è¾“å…¥æ–‡ä»¶é€šè¿‡ä¸Šé¢çš„æ–¹å¼ä¼ å…¥ã€‚&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;section level2&#34;&gt;
&lt;h2&gt;æ‰§è¡Œ&lt;/h2&gt;
&lt;pre class=&#34;sh&#34;&gt;&lt;code&gt;$ ls data
SRR1950772_1.fastq.gz  SRR1950772_2.fastq.gz  SRR1950773_1.fastq.gz  SRR1950773_2.fastq.gz
$ ./main.nf
N E X T F L O W  ~  version 19.09.0-edge
Launching `./main.nf` [desperate_mcnulty] - revision: f74174c1c6
WARN: DSL 2 IS AN EXPERIMENTAL FEATURE UNDER DEVELOPMENT -- SYNTAX MAY CHANGE IN FUTURE RELEASE
executor &amp;gt;  local (2)
[f7/14223b] process &amp;gt; DECONT (SRR1950773) [100%] 2 of 2 âœ”&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æŸ¥çœ‹ç»“æœï¼š&lt;/p&gt;
&lt;pre class=&#34;sh&#34;&gt;&lt;code&gt;$ ls pipeline_output/decont_out/
SRR1950772_fastpdecont_1.fastq.gz  SRR1950772.html  SRR1950773_fastpdecont_1.fastq.gz  SRR1950773.html
SRR1950772_fastpdecont_2.fastq.gz  SRR1950772.json  SRR1950773_fastpdecont_2.fastq.gz  SRR1950773.json&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å‚è€ƒï¼š
&lt;a href=&#34;https://www.nextflow.io/docs/latest/&#34; class=&#34;uri&#34;&gt;https://www.nextflow.io/docs/latest/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;(æœªå®Œ)&lt;/p&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>åŸºäºNextflowçš„å®åŸºå› ç»„æœ‰å‚åˆ†æ-II ä¸»å‡½æ•°å’Œè¾“å…¥è¾“å‡º</title>
      <link>/post/2019-09-29-nextflow-main/</link>
      <pubDate>Sun, 29 Sep 2019 00:00:00 +0000</pubDate>
      
      <guid>/post/2019-09-29-nextflow-main/</guid>
      <description>


&lt;div id=&#34;nextflow&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;ç¬¬ä¸€ä¸ªNextflowç¨‹åº&lt;/h2&gt;
&lt;p&gt;åˆ›å»ºä»¥ä¸‹åä¸ºmain.nfçš„Nextflowæ–‡ä»¶&lt;/p&gt;
&lt;pre class=&#34;groovy&#34;&gt;&lt;code&gt;#!/usr/bin/env nextflow

// DSL 2 syntax
nextflow.preview.dsl=2

// parameters
params.help = false
params.read_path  = &amp;quot;${workflow.projectDir}/data&amp;quot;

// help message
def helpMessage() {
    log.info&amp;quot;&amp;quot;&amp;quot;
    =================================================================
    Usage: ${workflow.projectDir}/main.nf --read_path PATH/OF/READS
    =================================================================
    &amp;quot;&amp;quot;&amp;quot;.stripIndent()
}
if (params.help){
    helpMessage()
    exit 0
}

// Create channel for reads
ch_reads = Channel
    .fromFilePairs(params.read_path + &amp;#39;/**{1,2}.f*q*&amp;#39;, flat: true)

ch_reads.view()&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div class=&#34;section level2&#34;&gt;
&lt;h2&gt;é€è¡Œè§£æ&lt;/h2&gt;
&lt;div id=&#34;shebang&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Shebang&lt;/h3&gt;
&lt;pre class=&#34;groovy&#34;&gt;&lt;code&gt;#!/usr/bin/env nextflow&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;åŒå¾ˆå¤šUnix-likeè„šæœ¬ä¸€æ ·ï¼Œç¬¬ä¸€è¡Œå«åš&lt;a href=&#34;https://en.wikipedia.org/wiki/Shebang_(Unix)&#34;&gt;â€œshebangâ€ (Hash bang)&lt;/a&gt;ï¼Œå‡ºç°åœ¨è„šæœ¬ç¬¬ä¸€è¡Œå¹¶ä»¥&lt;code&gt;#!&lt;/code&gt;å¼€å¤´ã€‚å®ƒå‘Šè¯‰ç³»ç»Ÿç”¨ä»€ä¹ˆç¯å¢ƒè½¯ä»¶å»è§£æè¿™ä¸ªè„šæœ¬ï¼Œå½“å®ƒå­˜åœ¨å¹¶ä¸”è„šæœ¬å¯æ‰§è¡Œçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç›´æ¥è°ƒç”¨è¯¥è„šæœ¬æ¥è¿è¡Œç¨‹åºã€‚ä»¥ä¸‹ä¸ºç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;ol style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;é€šè¿‡Interpreteræ¥è°ƒç”¨è„šæœ¬ï¼ˆshebangä¸å­˜åœ¨æ—¶ä¹Ÿå¯ä½¿ç”¨ï¼‰ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;pre class=&#34;sh&#34;&gt;&lt;code&gt;nextflow run ./main.nf&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;2&#34; style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;ç›´æ¥è°ƒç”¨ï¼ˆéœ€è¦shebangï¼‰ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;pre class=&#34;sh&#34;&gt;&lt;code&gt;chmod u+x ./main.nf ## æ·»åŠ å¯æ‰§è¡Œæƒé™
./main.nf           ## ç³»ç»Ÿè‡ªåŠ¨ä½¿ç”¨nextflowè¿è¡Œ&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;dsl2&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;ä½¿ç”¨DSL2è¯­è¨€&lt;/h3&gt;
&lt;pre class=&#34;groovy&#34;&gt;&lt;code&gt;nextflow.preview.dsl=2&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æ³¨ï¼šDSL2æ˜¯æ–°åŠŸèƒ½ï¼Œåç»­è¯­æ³•å¯èƒ½ä¼šè°ƒæ•´&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;section level3&#34;&gt;
&lt;h3&gt;æµç¨‹å‚æ•°&lt;/h3&gt;
&lt;pre class=&#34;groovy&#34;&gt;&lt;code&gt;// parameters
params.help = false
params.read_path  = &amp;quot;${workflow.projectDir}/data&amp;quot;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Nextflowé€šè¿‡paramsè¿™ä¸ªå­—å…¸æ¥å…è®¸æ‰§è¡Œæ—¶ç›´æ¥ä¼ å…¥å‚æ•°ã€‚ä¸Šè¿°çš„ä¸¤ä¸ªå‚æ•°&lt;code&gt;help&lt;/code&gt;ï¼Œå’Œ&lt;code&gt;read_path&lt;/code&gt;ï¼Œåœ¨å‘½ä»¤è¡Œä¸­å¯é€šè¿‡&lt;code&gt;--help&lt;/code&gt;ï¼Œ&lt;code&gt;--read_path /PATH/TO/READS&lt;/code&gt;ï¼Œæ¥æ›´æ”¹ã€‚&lt;/p&gt;
&lt;pre class=&#34;sh&#34;&gt;&lt;code&gt;./main.nf --help ## å°†params.helpçš„å€¼æ›´æ”¹ä¸ºtrue
./main.nf --read_path /data/reads/ ## å°†params.read_pathçš„å€¼æ›´æ”¹ä¸º~/reads&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;groovy&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;GroovyåŸç”Ÿæ”¯æŒ&lt;/h3&gt;
&lt;pre class=&#34;groovy&#34;&gt;&lt;code&gt;def helpMessage() {
    log.info&amp;quot;&amp;quot;&amp;quot;
    =================================================================
    Usage: ${workflow.projectDir}/main.nf --read_path PATH/OF/READS
    =================================================================
    &amp;quot;&amp;quot;&amp;quot;.stripIndent()
}
if (params.help){
    helpMessage()
    exit 0
}&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;NextflowåŸºäºGroovyè¯­è¨€ï¼Œå¯åœ¨æµç¨‹ä¸­ç›´æ¥ä½¿ç”¨ã€‚ä»¥ä¸Šéƒ¨åˆ†å®šä¹‰äº†å‡½æ•°&lt;code&gt;helppMessage&lt;/code&gt;ï¼Œåœ¨æ¥åˆ°&lt;code&gt;--help&lt;/code&gt;è¾“å…¥æ—¶ä¼šè¾“å‡ºå¸®åŠ©æ–‡æ¡£å¹¶é€€å‡ºæ‰§è¡Œã€‚&lt;code&gt;workflow&lt;/code&gt;ä¸ºNextflowå®šä¹‰çš„ç‰¹æ®Šå­—å…¸ï¼Œ&lt;code&gt;${workflow.projectDir}&lt;/code&gt;å¯¹åº”äº†å½“å‰è„šæœ¬(&lt;code&gt;main.nf&lt;/code&gt;)çš„ç›®å½•ã€‚&lt;/p&gt;
&lt;pre class=&#34;sh&#34;&gt;&lt;code&gt;$ ./main.nf --help
N E X T F L O W  ~  version 19.09.0-edge
Launching `./main.nf` [distraught_meitner] - revision: bb88634790
WARN: DSL 2 IS AN EXPERIMENTAL FEATURE UNDER DEVELOPMENT -- SYNTAX MAY CHANGE IN FUTURE RELEASE
=================================================================
Usage: /home/ubuntu/shotgunmetagenomics-nf/tutorial/main.nf --read_path PATH/OF/READS
=================================================================&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;channel&#34; class=&#34;section level3&#34;&gt;
&lt;h3&gt;Channel&lt;/h3&gt;
&lt;pre class=&#34;groovy&#34;&gt;&lt;code&gt;ch_reads = Channel
    .fromFilePairs(params.read_path + &amp;#39;/**{1,2}.f*q*&amp;#39;, flat: true)

ch_reads.view()&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Netflowå®šä¹‰äº†Channelï¼Œé€šè¿‡Channelæ¥åœ¨ä¸åŒè¿‡ç¨‹(Process)ä¹‹é—´ä¼ é€’æ–‡ä»¶ã€‚Channelä¿è¯äº†åŸºäºä¸åŒæ–‡ä»¶çš„è¿ç®—ç‹¬ç«‹ã€å¹¶è¡Œè¿›è¡Œã€‚Channelå¯¹åº”çš„æ–‡ä»¶ä¼šè¢«â€œæ‹·è´â€(ç»å¸¸ä»¥symbolic linkçš„å½¢å¼)åˆ°&lt;code&gt;work/&lt;/code&gt;ç›®å½•ä¸‹ã€‚è¿™ä¸ªå®šä¹‰å…¶å®ä¸æ˜¯å¾ˆå®¹æ˜“è¯´å¾—æ¸…æ¥šï¼Œå»ºè®®é˜…è¯»Nextflow&lt;a href=&#34;https://www.nextflow.io/docs/latest/channel.html&#34;&gt;å¸®åŠ©æ–‡æ¡£&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;fromFilePair&lt;/code&gt;ä¸“é—¨ä¸ºfastqæ‰“é€ ï¼Œå¯ä»¥ç›´æ¥å°†ä¸åŒçš„æ ·æœ¬ä»¥åˆ—è¡¨å½¢å¼åˆ†ç»„&lt;/li&gt;
&lt;li&gt;&lt;code&gt;&#39;/**{1,2}.f*q*&#39;&lt;/code&gt;å®šä¹‰äº†æ–‡ä»¶åŒ¹é…æ–¹å¼ï¼Œ&lt;code&gt;**&lt;/code&gt;è¡¨ç¤ºé€’å½’åœ°æ£€ç´¢æ–‡ä»¶ï¼Œ&lt;code&gt;{1,2}.f*q*&lt;/code&gt;è·Ÿbashæœ¬èº«çš„æ–‡ä»¶åŒ¹é…ä¸€è‡´ï¼Œè¿™é‡Œä¼šåŒ¹é…ç»“å°¾ä¸º&lt;code&gt;1.fastq.gz&lt;/code&gt;ï¼Œ&lt;code&gt;2.fastq&lt;/code&gt;ï¼Œ&lt;code&gt;1.fq&lt;/code&gt;ï¼Œ&lt;code&gt;2.fq.gz&lt;/code&gt;çš„æ–‡ä»¶&lt;/li&gt;
&lt;li&gt;&lt;code&gt;flat: ture&lt;/code&gt;ä½¿è¿”å›çš„åŒç«¯åºåˆ—å’ŒåŒ¹é…IDå­˜å‚¨ä¸ºä¸€ä¸ªåˆ—è¡¨ä¸­ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;pre class=&#34;sh&#34;&gt;&lt;code&gt;$ ls /data/reads/
SRR1950772_1.fastq.gz  SRR1950772_2.fastq.gz  SRR1950773_1.fastq.gz  SRR1950773_2.fastq.gz

$ ./main.nf --read_path /data/reads/
N E X T F L O W  ~  version 19.09.0-edge
Launching `./main.nf` [elegant_volta] - revision: bb88634790
WARN: DSL 2 IS AN EXPERIMENTAL FEATURE UNDER DEVELOPMENT -- SYNTAX MAY CHANGE IN FUTURE RELEASE
[SRR1950773, /data/reads/SRR1950773_1.fastq.gz, /data/reads/SRR1950773_2.fastq.gz]
[SRR1950772, /data/reads/SRR1950772_1.fastq.gz, /data/reads/SRR1950772_2.fastq.gz]&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å¦‚æœé»˜è®¤æƒ…å†µ (&lt;code&gt;flat: false&lt;/code&gt;)ä½¿ç”¨&lt;code&gt;.fromFilePairs(params.read_path + &#39;/**{1,2}.f*q*&#39;)&lt;/code&gt;ï¼Œè¾“å‡ºç»“æœä¼šå°†Read1å’ŒRead2åˆå¹¶åœ¨ä¸€ä¸ªåˆ—è¡¨ä¸­ï¼š&lt;/p&gt;
&lt;pre class=&#34;sh&#34;&gt;&lt;code&gt;[SRR1950773, [/data/reads/SRR1950773_1.fastq.gz, /data/reads/SRR1950773_2.fastq.gz]]
[SRR1950772, [/data/reads/SRR1950772_1.fastq.gz, /data/reads/SRR1950772_2.fastq.gz]]&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;å‚è€ƒï¼š
&lt;a href=&#34;https://www.nextflow.io/docs/latest/&#34; class=&#34;uri&#34;&gt;https://www.nextflow.io/docs/latest/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;(æœªå®Œ)&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>åŸºäºNextflowçš„å®åŸºå› ç»„æœ‰å‚åˆ†æ-I å®‰è£…Nextflow</title>
      <link>/post/2019-09-27-nextflow-install/</link>
      <pubDate>Fri, 27 Sep 2019 00:00:00 +0000</pubDate>
      
      <guid>/post/2019-09-27-nextflow-install/</guid>
      <description>


&lt;div class=&#34;section level2&#34;&gt;
&lt;h2&gt;å¼€ä¸€ä¸ªå‘&lt;/h2&gt;
&lt;p&gt;æœ¬ç³»åˆ—ä»‹ç»å¦‚ä½•æ­å»ºåŸºäºNextflowçš„å®åŸºå› ç»„æœ‰å‚åˆ†ææµç¨‹ã€‚åœ¨æ­¤ä¹‹å‰æˆ‘æ›¾ç»ä½¿ç”¨bpipeå’Œsnakemakeå†™è¿‡è¿™ä¸ª&lt;a href=&#34;https://github.com/lch14forever/shotgun-metagenomics-pipeline&#34;&gt;æµç¨‹&lt;/a&gt;ã€‚åœ¨æˆ‘ä»¬å®éªŒå®¤ä¸­æ‰€æœ‰çš„æœ‰å‚åˆ†æéƒ½æ˜¯è¿™ä¸ªpipelineè·‘å‡ºæ¥çš„ã€‚ä¸ªäººæ„Ÿè§‰bpipeç”¨èµ·æ¥å…¶å®å¾ˆé¡ºæ‰‹è‡ªç„¶ï¼Œä½†æ˜¯ç”±äºç¤¾åŒºå®åœ¨æ˜¯ä¸å¤Ÿæ´»è·ƒã€‚snakemakeåŸºäºpythonè€Œä¸”æœ‰å¾ˆå¤šå¼€å‘è€…æ”¯æŒï¼Œæ‰€ä»¥ä¸ºäº†å­¦ä¹ snakemakeï¼Œæˆ‘å°†ä¹‹å‰çš„æµç¨‹é‡æ–°å†™æˆäº†snakemakeã€‚ä½†æ˜¯åæ¥æ¸æ¸å‘ç°makeçš„è¿™ç§ä»åå‘å‰ç»“æ„å¾ˆåˆ«æ‰­ï¼ŒåŸºäºæ–‡ä»¶åæ„å»ºDAGä¹Ÿæ˜¯ç¼ºä¹çµæ´»æ€§ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.nextflow.io/&#34;&gt;Nextflow&lt;/a&gt;ä½œä¸ºåèµ·ä¹‹ç§€è¿…é€Ÿæˆé•¿ï¼Œæ‹¥æœ‰å¾ˆå¥½çš„ç¤¾åŒºæ”¯æŒï¼ˆ&lt;a href=&#34;https://groups.google.com/forum/#!forum/nextflow&#34;&gt;google group&lt;/a&gt;ï¼Œ&lt;a href=&#34;https://gitter.im/nextflow-io/nextflow&#34;&gt;gitter&lt;/a&gt;ï¼‰ï¼ŒåŸç”Ÿå¯¹äº‘ç¯å¢ƒï¼ˆAWSï¼Œgoogle cloudï¼‰æ”¯æŒï¼Œæ‹¥æœ‰å¤§é‡ä¼˜ç§€æˆç†Ÿæµç¨‹&lt;a href=&#34;https://github.com/nf-core&#34;&gt;nf-core&lt;/a&gt;ã€‚æœ€è¿‘çš„ä¸€æ¬¡æ›´æ–°æ¨å‡ºäº†æ¨¡å—åŒ–çš„&lt;a href=&#34;https://www.nextflow.io/blog/2019/one-more-step-towards-modules.html&#34;&gt;DSL 2æ¶æ„&lt;/a&gt;ï¼Œæ„å»ºå¯é‡å¤åˆ©ç”¨çš„æµç¨‹æœªæ¥å¯æœŸã€‚ä¸ºäº†æ›´å¥½åœ°å­¦ä¹ Nextflowï¼Œæˆ‘å°†æŠŠä¹‹å‰çš„shotgunMetagenomicsæµç¨‹é‡å†™ï¼Œå¹¶æŠŠè¿‡ç¨‹è®°å½•ä¸‹æ¥ï¼Œä¹Ÿå¸Œæœ›å¯ä»¥å¸®åŠ©åˆ°æ›´å¤šäººã€‚&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;section level2&#34;&gt;
&lt;h2&gt;æµç¨‹ä»‹ç»&lt;/h2&gt;
&lt;p&gt;è¿™ä¸ªæµç¨‹å¯ä»¥å‚è§snakemakeç”Ÿæˆçš„DAG:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/lch14forever/shotgun-metagenomics-pipeline/raw/master/snakemake_pipeline/work_flow.png&#34; /&gt;&lt;/p&gt;
&lt;p&gt;æ­¥éª¤ä¸ºï¼š&lt;/p&gt;
&lt;ol style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;åˆå¹¶ç›¸åŒæ ·æœ¬&lt;/li&gt;
&lt;li&gt;å»æ¥å¤´&lt;/li&gt;
&lt;li&gt;å»å®¿ä¸»DNA&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨Profilingå·¥å…·ï¼ˆkraken2ï¼ŒMetaPhlAn2ï¼‰&lt;/li&gt;
&lt;li&gt;æŒ‰ç³»ç»Ÿåˆ†ç±»æ‹†åˆ†&lt;/li&gt;
&lt;li&gt;åˆå¹¶&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;## å®‰è£…Nextflow&lt;/p&gt;
&lt;p&gt;ä¾èµ–ï¼šjava &amp;gt;= 1.8&lt;/p&gt;
&lt;p&gt;ç¨³å®šç‰ˆæœ¬å®‰è£…ï¼š&lt;/p&gt;
&lt;pre class=&#34;sh&#34;&gt;&lt;code&gt;curl -s https://get.nextflow.io | bash&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Githubå¼€å‘ç‰ˆæœ¬å®‰è£…ï¼Œæ”¯æŒDSL2è¯­æ³•ï¼š&lt;/p&gt;
&lt;pre class=&#34;sh&#34;&gt;&lt;code&gt;git clone https://github.com/nextflow-io/nextflow.git

cd nextflow

make compile

make pack&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;æœ€åçš„Nextflowåœ¨&lt;code&gt;build/releases/nextflow-19.09.0-edge-all&lt;/code&gt;ï¼Œå¯ä»¥é‡æ–°å‘½åä¸º&lt;code&gt;nextflow&lt;/code&gt;å¹¶æ”¾åœ¨&lt;code&gt;$PATH&lt;/code&gt;ä¸­ã€‚&lt;/p&gt;
&lt;pre class=&#34;sh&#34;&gt;&lt;code&gt;export PATH=$PATH:/PATH/TO/REPO/build/releases/&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;(æœªå®Œ)&lt;/p&gt;
&lt;/div&gt;
</description>
    </item>
    
  </channel>
</rss>
