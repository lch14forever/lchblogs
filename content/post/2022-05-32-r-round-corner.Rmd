---
title: "圆角barplot"
author: "Chenhao Li"
output: html_document
categories: ["R", "ggplot2"]
tags: ["R", "ggplot2"]
date: 2021-08-30
summary: "不同方法实现ggplot2圆角barplot"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


### 依赖

```{r}
library(dplyr)
library(ggplot2)
```

### 数据

```{r}
dat <-  mutate(mtcars, index=1:n())
dat
```

### 基础作图

欧式坐标
```{r}
ggplot(dat, aes(x=index, y=mpg)) + 
  geom_bar(stat="identity") + 
  theme(axis.text.x = element_blank())
```
极坐标
```{r}
ggplot(dat, aes(x=index, y=mpg)) + 
  geom_bar(stat="identity") + 
  theme(axis.text.x = element_blank()) + 
  coord_polar()
```


### 方法1：`geom_segment` + `lineend = "round"`

```{r}
ggplot(dat, aes(x=index, xend=index,  y=0,yend=mpg)) + 
  geom_segment(lwd=4, lineend = "round")  +
  theme(axis.text.x = element_blank()) 
```

```{r}
ggplot(dat, aes(x=index, xend=index,  y=0,yend=mpg)) + 
  geom_segment(lwd=4, lineend = "round") + 
  theme(axis.text.x = element_blank())  + 
  coord_polar()
```
在极坐标中似乎不是我们想要的，因为线段的宽度不能极坐标化

### 方法2：`ggchicklet`

```{r}
#remotes::install_gitlab("hrbrmstr/ggchicklet")

ggplot(dat, aes(x=index,  y=mpg)) + 
  ggchicklet::geom_chicklet() + 
  theme(axis.text.x = element_blank())  
```
```{r}
ggplot(dat, aes(x=index,  y=mpg)) + 
  ggchicklet::geom_chicklet() + 
  coord_polar() + 
  theme(axis.text.x = element_blank()) 
```
在极坐标下出现错误

### 方法3：`elementalist`

```{r}
#remotes::install_github("teunbrand/elementalist")
ggplot(dat, aes(x=index, y = mpg)) +
  elementalist::geom_bar_theme(stat="identity",
    element = elementalist::element_rect_round(radius = 0.25)) +
  theme(axis.text.x = element_blank()) 
```

```{r  error=TRUE}
ggplot(dat, aes(x=index, y = mpg)) +
  elementalist::geom_bar_theme(stat="identity",
    element = elementalist::element_rect_round(radius = 0.25)) +
  theme(axis.text.x = element_blank()) +
  coord_polar()
```

作者说，极坐标这个功能还没有实现😅

### 最终方法：`ggforce::geom_shape()`

对`x`，`y`进行处理

```{r}
w <- 0.4

dat2 <- rbind(
  mutate(dat, index.new=index-w, mpg=0),
  mutate(dat, index.new=index+w, mpg=0),
  mutate(dat, index.new=index+w, mpg=mpg),
  mutate(dat, index.new=index-w, mpg=mpg)
  ) 
```

```{r}
ggplot(dat2, aes(x=index.new, y=mpg, group=index)) + 
  ggforce::geom_shape(radius = unit(1.2, 'mm') ) +
  theme(axis.text.x = element_blank())
```

```{r fig.height=6, fig.width=6}
ggplot(dat2, aes(x=index.new, y=mpg, group=index)) + 
  ggforce::geom_shape( radius = unit(1.2, 'mm')) +
  coord_polar() + 
  labs(x=NULL, y=NULL) + 
  theme(axis.text = element_blank(), axis.ticks = element_blank()) 
```


### 运行信息

```{r}
sessionInfo()
```
